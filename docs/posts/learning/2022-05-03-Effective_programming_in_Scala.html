
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Effective Programming in Scala &#8212; PJnotes 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/pj_touch.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Quants interview" href="../math/2020-01-03-black-scholes-quants.html" />
    <link rel="prev" title="IBM Containers and Kubernetes" href="2021-08-04-IBM_containers.html" />
   
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
  <link rel="stylesheet" href="../../_static/css/pj_print.css" media="print", type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  </head><body>
    <header>
        <div class="logo-box">
            <svg height="70" width="26">
            <path d="M 3 59
                     l 0 -42
                     A 10 10 1 0 1 23 17
                     l 0 37
                     A 7 7 1 0 1 9 54
                     l 0 -30
                     A 5 5 1 0 1 19 24
                     l 0 20" stroke="black" stroke-width="2" fill="none"/>
            </svg>
            <a href="../../index.html">Prophet<br>Jeremy's<br>
                <span style="font-family:PT Serif Caption; color:var(--special-words); font-size:20px">
                    notes
                </span>
            </a>
        </div>
        <input id="nav-toggle" type="checkbox" class="nav-toggle">
        <nav>
            <ul>
                <li><a href=../../cv.html>CV</a></li>
                <li><a href=../../about.html>About</a></li>
                <li><a href=../../recommendations.html>Recommendations</a></li>
            </ul>
        </nav>
        <label for="nav-toggle" class="nav-toggle-label">
            <span class="nav-toggle-m1 nav-toggle-mvert"></span>
            <span class="nav-toggle-m2 nav-toggle-mdiag"></span>
            <span class="nav-toggle-m3 nav-toggle-mdiag"></span>
            <span class="nav-toggle-m4 nav-toggle-mvert"></span>
        </label>
    </header>
    <div class="container">
        
        <input id="sidebar-toggle" type="checkbox" class="sidebar-toggle">
        <div class="sidebar">



<h3>Navigate: 
      <a href="2021-08-04-IBM_containers.html" title="previous document">&lArr;</a>
      <a href="../math/2020-01-03-black-scholes-quants.html" title="next document">&rArr;</a></h3>
<div class="toc">
    <ul>
<li><a class="reference internal" href="#">Effective Programming in Scala</a><ul>
<li><a class="reference internal" href="#basics">Basics</a><ul>
<li><a class="reference internal" href="#types">Types</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#branching">Branching</a></li>
<li><a class="reference internal" href="#evaluations">Evaluations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domain-modeling">Domain Modeling</a><ul>
<li><a class="reference internal" href="#case-classes">Case classes</a></li>
<li><a class="reference internal" href="#sealed-traits">Sealed traits</a></li>
<li><a class="reference internal" href="#enumerations">Enumerations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#standard-library">Standard Library</a><ul>
<li><a class="reference internal" href="#lists">Lists</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collections-most-common">Collections (most common)</a><ul>
<li><a class="reference internal" href="#tuples">Tuples</a></li>
<li><a class="reference internal" href="#sequences-vs-maps">Sequences vs Maps</a></li>
<li><a class="reference internal" href="#option">Option</a></li>
<li><a class="reference internal" href="#loops">Loops</a><ul>
<li><a class="reference internal" href="#for-loop">For loop</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concatenating">Concatenating</a></li>
</ul>
</li>
<li><a class="reference internal" href="#organize-code">Organize code</a><ul>
<li><a class="reference internal" href="#developer-workflow">Developer Workflow</a><ul>
<li><a class="reference internal" href="#sbt">sbt</a></li>
<li><a class="reference internal" href="#program-entry-point">Program entry point</a></li>
</ul>
</li>
<li><a class="reference internal" href="#encapsulation">Encapsulation</a><ul>
<li><a class="reference internal" href="#case-classes-vs-simple-classes">Case classes vs “Simple” classes</a></li>
<li><a class="reference internal" href="#sealed-traits-vs-simple-traits">Sealed traits vs “Simple” traits</a></li>
<li><a class="reference internal" href="#opaque-type-aliases">Opaque type aliases</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#code-reasoning">Code reasoning</a><ul>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#property-based">Property based</a></li>
<li><a class="reference internal" href="#mocking">Mocking</a></li>
<li><a class="reference internal" href="#integration-testing">Integration testing</a></li>
<li><a class="reference internal" href="#type-directed-programming">Type-Directed Programming</a><ul>
<li><a class="reference internal" href="#scala-3-vs-scala-2">Scala 3 vs. Scala 2</a></li>
<li><a class="reference internal" href="#extension-methods">Extension methods</a></li>
<li><a class="reference internal" href="#implicit-conversions">Implicit conversions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling">Error handling</a><ul>
<li><a class="reference internal" href="#defensive-programming">Defensive programming</a></li>
<li><a class="reference internal" href="#validating-data">Validating data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concurrent-programming">Concurrent programming</a><ul>
<li><a class="reference internal" href="#execution-context">Execution context</a></li>
</ul>
</li>
<li><a class="reference internal" href="#business-logic">Business Logic</a><ul>
<li><a class="reference internal" href="#video-streaming-footprint">Video Streaming Footprint</a></li>
<li><a class="reference internal" href="#card-game-set">Card Game: Set</a></li>
<li><a class="reference internal" href="#basketball">Basketball</a></li>
<li><a class="reference internal" href="#managing-addressbook">Managing AddressBook</a></li>
<li><a class="reference internal" href="#parsing-a-list-of-dates-from-a-file">Parsing a list of dates from a file</a></li>
<li><a class="reference internal" href="#fetching-data-from-webservice">Fetching data from webservice</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
<script src="../../_static/js/toc.js"></script>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search:</h3>
  <form class="search" action="../../search.html" method="get">
      <input class="search-box" type="text" name="q" aria-labelledby="searchlabel" />
      <input class="search-button" type="submit" value="&lt;" />
  </form>
</div>
<script>$('#searchbox').show(0);</script>

<hr>
<div class="social-icons">
    
    <a href="mailto:santibreo@gmail.com?subject=We want to hire you">
        <i class="fa fa-envelope"></i>
    </a>
    
    
    <a href=https://github.com/santibreo><i class="fab fa-github"></i></a>
    
    <a href=https://twitter.com/santibreo><i class="fab fa-twitter"></i></a>
    
    <a href=https://www.linkedin.com/in/santibreo/><i class="fab fa-linkedin"></i></a>
    
</div>
<hr>
</div>
        <label for="sidebar-toggle" class="sidebar-toggle-label">
            <span></span>
        </label>
        
        <div class="content">
        
  <div class="section" id="effective-programming-in-scala">
<h1>Effective Programming in Scala<a class="headerlink" href="#effective-programming-in-scala" title="Permalink to this headline"> &sect;</a></h1>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline"> &sect;</a></h2>
<p>For symbolic operations <strong>infix syntax</strong> is preferred over <strong>dot-notation</strong>, so, for example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kc">true</span> <span class="o">&amp;&amp;</span> <span class="kc">true</span>   <span class="c1">// prefered</span>
<span class="kc">true</span><span class="p">.</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>  <span class="c1">// equivalent</span>
<span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span>      <span class="c1">// prefered</span>
<span class="mi">1</span><span class="p">.</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>    <span class="c1">// equivalent</span>
</pre></div>
</div>
<div class="section" id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this headline"> &sect;</a></h3>
<ul class="simple">
<li><p>Boolean: <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p>Int: 32-bit signed integer, i.e.: <span class="math notranslate nohighlight">\(x \in [-2^{31}, 2^{31} - 1]\)</span>.</p></li>
<li><p>Double: 64-bit floating point number.</p></li>
<li><p>String: Text.</p></li>
</ul>
<p>The result of arithmetic operations has the type of the widest operand, if an operation expects a <code class="docutils literal notranslate"><span class="pre">Double</span></code> and <code class="docutils literal notranslate"><span class="pre">Int</span></code> is passed, it is automatically expanded. However if an <code class="docutils literal notranslate"><span class="pre">Int</span></code> is expected and a <code class="docutils literal notranslate"><span class="pre">Double</span></code> is passed, a type error is raised.</p>
<p>As types define how expressions can be combined by applying operations to them, operations are also called members of types. If you try to apply an operation on an expression whose type does not provide such an operation an error is raised.</p>
<p>Scala compiler check that programs are well typed before they are evaluated, so type errors can’t happen at run-time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In worksheets there is no distinction between compilation and evaluation.</p>
</div>
<p>Types can be explicitly indicated like so: <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">number:</span> <span class="pre">Int</span> <span class="pre">=</span>&#160; <span class="pre">5</span> <span class="pre">*</span> <span class="pre">3</span></code>, however, in general the compiler is able to infer such types.</p>
</div>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">door</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.5</span>
<span class="k">def</span> <span class="nf">house</span><span class="p">(</span><span class="n">facade</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span> <span class="nc">Double</span> <span class="o">=</span>
  <span class="n">facade</span> <span class="o">-</span> <span class="n">door</span> <span class="o">-</span> <span class="n">window</span> <span class="o">*</span> <span class="mi">2</span>
<span class="k">end</span> <span class="nn">house</span>
</pre></div>
</div>
<p>In the example <code class="docutils literal notranslate"><span class="pre">facade</span></code> and <code class="docutils literal notranslate"><span class="pre">window</span></code> are parameters of the method <code class="docutils literal notranslate"><span class="pre">house</span></code>. The body of method (method definition) can expand several lines, all the lines with the same level of indentation make a block, which ends up with the <strong>resulting expression</strong>, and optionally you can add an <code class="docutils literal notranslate"><span class="pre">end</span></code> statement, like in the example.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In Scala 2 blocks were delimited by braces (‘{…}’)</p>
</div>
<p>Explicit result types are not necessary but recommended to improve code readability.</p>
<p>Finally, names introduced within a block are not visible outside that block.</p>
</div>
<div class="section" id="branching">
<h3>Branching<a class="headerlink" href="#branching" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showPrice</span><span class="p">(</span><span class="n">paintingArea</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">paintPrice</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span> <span class="nc">String</span> <span class="o">=</span>
  <span class="kd">val</span> <span class="n">price</span> <span class="o">=</span> <span class="n">paintingArea</span> <span class="o">*</span> <span class="n">paintPrice</span>
  <span class="k">if</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">then</span>
    <span class="s">&quot;This is too expensive&quot;</span>
  <span class="k">else</span>
    <span class="n">price</span><span class="p">.</span><span class="n">toString</span>
</pre></div>
</div>
<p>If expressions take a condition followed by the keyword <code class="docutils literal notranslate"><span class="pre">then</span></code>. It worth noting that <code class="docutils literal notranslate"><span class="pre">if/else</span></code> construct is an expression (it evaluates to a value). Condition must be of type Boolean. More branches can be settled by using <code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">if</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In Scala 2 the condition was written parenthesized (‘(…)’)</p>
</div>
</div>
<div class="section" id="evaluations">
<h3>Evaluations<a class="headerlink" href="#evaluations" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">tenSquared</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">10</span>
<span class="k">def</span> <span class="nf">tenSquared</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Above expressions are similar but are evaluated differently. While <code class="docutils literal notranslate"><span class="pre">def</span></code> definitions are evaluated <strong>each time they are called</strong>, <code class="docutils literal notranslate"><span class="pre">val</span></code> definitions <strong>are evaluated once</strong> and reused each time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">???</span></code> is a useful ally when you are designing. It allows you sketch some pieces of code here and there without having to fully implement them.</p>
</div>
</div>
</div>
<div class="section" id="domain-modeling">
<h2>Domain Modeling<a class="headerlink" href="#domain-modeling" title="Permalink to this headline"> &sect;</a></h2>
<p>When we talk about <strong>levels of abstraction</strong> high level means more abstract, being the lowest level each instance itself (a door, a window, a facade) and higher levels those enclosing one or more of these concepts (shape).</p>
<div class="section" id="case-classes">
<h3>Case classes<a class="headerlink" href="#case-classes" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">area</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">height</span>

<span class="kd">val</span> <span class="n">facade</span> <span class="o">=</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">facade</span><span class="p">.</span><span class="n">area</span>
</pre></div>
</div>
<p>Case classes are immutable, they come with a <code class="docutils literal notranslate"><span class="pre">copy</span></code> method to create a copy updating some fields.</p>
</div>
<div class="section" id="sealed-traits">
<h3>Sealed traits<a class="headerlink" href="#sealed-traits" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Shape</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="k">extends</span> <span class="nc">Shape</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">radius</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="k">extends</span> <span class="nc">Shape</span>
</pre></div>
</div>
<p>Shape is either a Rectangle or a Circle. Sealed trait do not introduce constructors (unlike case classes) so they are <strong>abstract types</strong>. The only way to construct a Shape is using a class that extends it:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">someShape</span><span class="p">:</span> <span class="nc">Shape</span> <span class="o">=</span> <span class="nc">Circle</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someShapeArea</span><span class="p">(</span><span class="n">someShape</span><span class="p">:</span> <span class="nc">Shape</span><span class="p">):</span> <span class="nc">Double</span> <span class="o">=</span>
  <span class="n">someShape</span> <span class="k">match</span><span class="p">:</span>
    <span class="k">case</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">width</span> <span class="o">*</span> <span class="n">height</span>
    <span class="k">case</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>          <span class="o">=&gt;</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mf">3.14</span>
</pre></div>
</div>
<p>This way Rectangle and Circle are subtypes of Shape. The most common use of Shape is to recover its concrete type using a <code class="docutils literal notranslate"><span class="pre">match</span></code> expression. If match does not match all the cases the compiler will warn. <strong>Wildcard pattern</strong> (<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">_</span></code>) can be used to match the rest of patterns.</p>
</div>
<div class="section" id="enumerations">
<h3>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">PrimaryColor</span><span class="p">:</span>
  <span class="k">case</span> <span class="nc">Red</span><span class="p">,</span> <span class="nc">Blue</span><span class="p">,</span> <span class="nc">Green</span>
</pre></div>
</div>
<p>This is just syntactic sugar for a sealed trait and case objects useful when alternative values of a type are not classes of values but singleton values (exactly 3 in the example). Enumerations provide a <code class="docutils literal notranslate"><span class="pre">values</span></code> operation that enumerates all their possible values as an Array. Also the operation <code class="docutils literal notranslate"><span class="pre">valueOf</span></code> allows to pass the singleton as a String.</p>
</div>
</div>
<div class="section" id="standard-library">
<h2>Standard Library<a class="headerlink" href="#standard-library" title="Permalink to this headline"> &sect;</a></h2>
<p>It includes a lot of domain-agnostic data structures and utility functions as:</p>
<ul class="simple">
<li><p>Collections</p></li>
<li><p>Error management</p></li>
<li><p>Math functions</p></li>
<li><p>Asynchronous execution</p></li>
</ul>
<div class="section" id="lists">
<h3>Lists<a class="headerlink" href="#lists" title="Permalink to this headline"> &sect;</a></h3>
<p>One of the most useful is the <code class="docutils literal notranslate"><span class="pre">List</span></code> which can include one data type (all elements must have the same type) and preserves the order:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">AddressBook</span><span class="p">(</span><span class="n">contacts</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Contact</span><span class="p">])</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span>
  <span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="n">email</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="n">phoneNumbers</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span>
<span class="p">)</span>

<span class="kd">val</span> <span class="n">alice</span> <span class="o">=</span> <span class="nc">Contact</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span> <span class="s">&quot;alice@sca.la&quot;</span><span class="p">,</span> <span class="nc">List</span><span class="p">())</span>
<span class="kd">val</span> <span class="n">bob</span>   <span class="o">=</span> <span class="nc">Contact</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="s">&quot;bob@sca.la&quot;</span><span class="p">,</span> <span class="nc">List</span><span class="p">(</span><span class="s">&quot;+34 666 111 222&quot;</span><span class="p">))</span>

<span class="kd">val</span> <span class="n">addressBook</span> <span class="o">=</span> <span class="nc">AddressBook</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">))</span>
</pre></div>
</div>
<p>In general, <strong>collection types</strong> are parametrized by the type of their elements. <code class="docutils literal notranslate"><span class="pre">List</span></code> provides a bunch of useful methods:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">numberOfContacts</span> <span class="o">=</span> <span class="n">addressBook</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">size</span>
<span class="kd">val</span> <span class="n">isAliceInContacts</span> <span class="o">=</span> <span class="n">addressBook</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
<span class="kd">val</span> <span class="n">contactNames</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">addressBook</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">contact</span> <span class="o">=&gt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="kd">val</span> <span class="n">contactWithPhone</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Contact</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">addressBook</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">contact</span> <span class="o">=&gt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">phoneNumbers</span><span class="p">.</span><span class="n">nonEmpty</span><span class="p">)</span>
</pre></div>
</div>
<p>List presents the following Data Layout</p>
<a class="reference internal image-reference" href="../../_images/list_data_layout.PNG"><img alt="Lists Data Layout" src="../../_images/list_data_layout.PNG" style="width: 70%;" /></a>
<p>Lists are immutable, but new lists can be created from previous existing ones:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">contacts1</span> <span class="o">=</span> <span class="nc">List</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">)</span>
<span class="kd">val</span> <span class="n">contacts2</span> <span class="o">=</span> <span class="n">carol</span> <span class="o">::</span> <span class="n">contacts1</span> <span class="c1">// contacts2 = List(carol, alice, bob)</span>
</pre></div>
</div>
<p>Constructing a new list by <strong>prepending elements to an existing list is a constant time operation</strong>, tail list is not copied, just reused. This data structure is called <strong>persistent data structure</strong> because previous state of the list is never changed. Calling <code class="docutils literal notranslate"><span class="pre">List</span></code> constructor is equivalent to (using the <strong>right associative</strong> <code class="docutils literal notranslate"><span class="pre">::</span></code> <strong>operator and</strong> <code class="docutils literal notranslate"><span class="pre">Nil</span></code> <strong>element</strong>):</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">List</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">)</span> <span class="o">==</span> <span class="n">alice</span> <span class="o">::</span> <span class="n">bob</span> <span class="o">::</span> <span class="nc">Nil</span>
<span class="n">alice</span> <span class="o">::</span> <span class="n">bob</span> <span class="o">::</span> <span class="nc">Nil</span> <span class="o">==</span> <span class="p">(</span><span class="n">alice</span> <span class="o">::</span> <span class="p">(</span><span class="n">bob</span> <span class="o">::</span> <span class="nc">Nil</span><span class="p">))</span>
<span class="n">alice</span> <span class="o">::</span> <span class="n">bob</span> <span class="o">::</span> <span class="nc">Nil</span> <span class="o">==</span> <span class="nc">Nil</span><span class="p">.</span><span class="n">::</span><span class="p">(</span><span class="n">bob</span><span class="p">).</span><span class="n">::</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Operators that end with “<code class="docutils literal notranslate"><span class="pre">:</span></code>” in Scala are right associative</p>
</div>
<p>When we use pattern matching on lists we can use the <code class="docutils literal notranslate"><span class="pre">Nil</span></code> element to identify empty list, or the wildcard pattern to match all non-treated cases.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">head</span></code>, <code class="docutils literal notranslate"><span class="pre">tail</span></code> or their index (beginning with 0) we can access individual elements in a list. There are also other valuable methods <code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">take</span></code>, <code class="docutils literal notranslate"><span class="pre">drop</span></code>, (just try them).</p>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">increment</span><span class="p">:</span> <span class="nc">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="o">=</span>
  <span class="n">x</span> <span class="o">=&gt;</span>
    <span class="kd">val</span> <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">result</span>

<span class="kd">val</span> <span class="n">add</span> <span class="o">=</span>
  <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">increment</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="c1">// Int: 4</span>
</pre></div>
</div>
<p>In the second type Scala will infer the type of the result (it cannot infer the type of the parameters). Generally <code class="docutils literal notranslate"><span class="pre">(t1,</span> <span class="pre">t2,</span> <span class="pre">…,</span> <span class="pre">tn)</span> <span class="pre">=&gt;</span> <span class="pre">e</span></code> is a function of <code class="docutils literal notranslate"><span class="pre">n</span></code> parameters which returns <code class="docutils literal notranslate"><span class="pre">e</span></code>. In case the types cannot be inferred (as in the <code class="docutils literal notranslate"><span class="pre">List.map</span></code> example) their types must be provided. A <strong>function is a value, so it has a function type</strong>. Syntax for <em>function types</em> is like syntax for function literals: <code class="docutils literal notranslate"><span class="pre">(T1,</span> <span class="pre">T2,</span> <span class="pre">…,</span> <span class="pre">Tn)</span> <span class="pre">=&gt;</span> <span class="pre">R</span></code>.</p>
<p>The difference between a Function and a Method is that a function is a value, so it can be passed as a parameter or returned as a result (for functional programming purposes). Runtime creates an object for it in memory. Calling a function is equivalent to call its method <code class="docutils literal notranslate"><span class="pre">apply</span></code>. So <code class="docutils literal notranslate"><span class="pre">increment(2)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">increment.apply(2)</span></code>. Compiler is able to convert methods into functions when necessary.</p>
<p>As a recall: A function that takes a parameter of type A and returns result of type B is a value of type <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">B</span></code> which has an apply method:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nc">A</span><span class="p">):</span> <span class="nc">B</span>
</pre></div>
</div>
<p>Functions support what is called <strong>placeholder syntax</strong>: <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">increment:</span> <span class="pre">Int</span> <span class="pre">=&gt;</span> <span class="pre">Int</span> <span class="pre">=</span> <span class="pre">_</span> <span class="pre">+</span> <span class="pre">1</span></code> where underscore “<code class="docutils literal notranslate"><span class="pre">_</span></code>” is a placeholder occupying the place of the passed argument. An also valid notations would be: <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">increment</span> <span class="pre">=</span> <span class="pre">(_:</span> <span class="pre">Int)</span> <span class="pre">+</span> <span class="pre">1</span></code>. There is also valid to use the <strong>wildcard pattern</strong> when we are ignoring the arguments provided, e.g. <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">constant</span> <span class="pre">=</span> <span class="pre">(_:</span> <span class="pre">Int)</span> <span class="pre">=&gt;</span> <span class="pre">42</span></code>.</p>
</div>
</div>
<div class="section" id="collections-most-common">
<h2>Collections (most common)<a class="headerlink" href="#collections-most-common" title="Permalink to this headline"> &sect;</a></h2>
<p>One if the most relevant members of collections has already been treated (<code class="docutils literal notranslate"><span class="pre">List</span></code>). As illustrative 3 types of collections will be compared:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">List</span></code> which is an immutable sequence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayBuffer</span></code> which is a mutable sequence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Map</span></code> which is an immutable dictionary / hash table / associative array.</p></li>
</ol>
<p>Immutable collections are already available in Scala, but mutable ones require to import <code class="docutils literal notranslate"><span class="pre">scala.collection.mutable</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">collection</span><span class="p">.</span><span class="n">mutable</span>
<span class="kd">val</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">()</span>
</pre></div>
</div>
<p>This makes clear when a mutable collection is being created.</p>
<p>To construct a collection the most simple way is calling the <code class="docutils literal notranslate"><span class="pre">empty</span></code> method and the elements type between square brackets (<code class="docutils literal notranslate"><span class="pre">[…]</span></code>), e.g.: <code class="docutils literal notranslate"><span class="pre">Map.empty[String,</span> <span class="pre">Boolean]</span></code> or <code class="docutils literal notranslate"><span class="pre">mutable.ArrayBuffer.empty[Double]</span></code>. The simplest way is passing the arguments parenthesized, which is often called <strong>vararg constructor</strong>. For <code class="docutils literal notranslate"><span class="pre">Map</span></code> association is marked with an arrow <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>, e.g.: <code class="docutils literal notranslate"><span class="pre">Map(&quot;a&quot;</span> <span class="pre">-&gt;</span> <span class="pre">true,</span> <span class="pre">&quot;b&quot;</span> <span class="pre">-&gt;</span> <span class="pre">False)</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If no type is provided to the <code class="docutils literal notranslate"><span class="pre">empty</span></code> method, Scala inferred the type of the elements as <code class="docutils literal notranslate"><span class="pre">Nothing</span></code>.</p>
</div>
<p>Prepending and appending elements to a collection can be done with <code class="docutils literal notranslate"><span class="pre">+:</span></code> and <code class="docutils literal notranslate"><span class="pre">:+</span></code> respectively.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="o">+:</span> <span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">// List(0, 1, 2, 3)</span>
<span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">)</span> <span class="o">:+</span> <span class="s">&quot;c&quot;</span> <span class="c1">// ArrayBuffer(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</span>
</pre></div>
</div>
<p>As maps does not store values in any specific order we cannot prepend or append, we can update the map using simple <code class="docutils literal notranslate"><span class="pre">+</span></code> operator.</p>
<p>When calling <code class="docutils literal notranslate"><span class="pre">find</span></code> method on a collection we obtain <strong>the first element that matches the passed condition</strong>, e.g. <code class="docutils literal notranslate"><span class="pre">List(1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4).find(x</span> <span class="pre">=&gt;</span> <span class="pre">x</span> <span class="pre">%</span> <span class="pre">2</span> <span class="pre">==</span> <span class="pre">0)</span> <span class="pre">//</span> <span class="pre">Some(2)</span></code>. This method returns an <code class="docutils literal notranslate"><span class="pre">Option</span></code> indicating that result might or might not be encountered. Options has 2 possible cases: <code class="docutils literal notranslate"><span class="pre">Some</span></code> when there is a value and <code class="docutils literal notranslate"><span class="pre">None</span></code> when there isn’t.</p>
<p>Using method <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> instead of <code class="docutils literal notranslate"><span class="pre">map</span></code> method allow us <strong>change the number of elements in a collection</strong>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">phoneNumbers</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">String</span><span class="p">])</span>
<span class="kd">val</span> <span class="n">contacts</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Contact</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// This returns a List of Lists</span>
<span class="kd">val</span> <span class="n">allPhoneNumbers</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">contact</span> <span class="o">=&gt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">phoneNumbers</span><span class="p">)</span>
<span class="c1">// This returns a List of phoneNumbers</span>
<span class="kd">val</span><span class="p">.</span><span class="n">allPhoneNumber</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">contact</span> <span class="o">=&gt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">phoneNumbers</span><span class="p">)</span>
</pre></div>
</div>
<p>Other useful method to transform a collection is <code class="docutils literal notranslate"><span class="pre">foldLeft</span></code> (equivalent to <code class="docutils literal notranslate"><span class="pre">reduce</span></code> in Python) it takes two <strong>parameters lists</strong> the first result and a function of two parameters, the previous result and the next item, then this function is applied to each element of the collection, i.e. <code class="docutils literal notranslate"><span class="pre">xs.foldLeft(z)(f)</span> <span class="pre">==</span> <span class="pre">f(f(…(f(f(z,</span> <span class="pre">xs(0)),</span> <span class="pre">xs(1)),</span> <span class="pre">…),</span> <span class="pre">xs(n-2)),</span> <span class="pre">xs(n-1))</span></code>. Some examples:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="n">foldLeft</span><span class="p">(</span><span class="mi">0</span><span class="p">)((</span><span class="n">accum</span><span class="p">,</span> <span class="n">elt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">accum</span> <span class="o">+</span> <span class="n">elt</span><span class="p">)</span> <span class="c1">// 6</span>
<span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="n">foldLeft</span><span class="p">(</span><span class="nc">List</span><span class="p">.</span><span class="n">empty</span><span class="p">[</span><span class="nc">Int</span><span class="p">])((</span><span class="n">accum</span><span class="p">,</span> <span class="n">elt</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="n">elt</span> <span class="o">+:</span> <span class="n">accum</span>
<span class="p">)</span> <span class="c1">// List(3, 2, 1)</span>
<span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="n">foldLeft</span><span class="p">(</span><span class="kc">true</span><span class="p">)((</span><span class="n">accum</span><span class="p">,</span> <span class="n">elt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">elt</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// false</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To reverse a list using the <code class="docutils literal notranslate"><span class="pre">reverse</span></code> method is preferred</p>
</div>
<p>Another way to transform collections is using <code class="docutils literal notranslate"><span class="pre">groupBy</span></code>, that separates elements into groups defined by a partition function which is a non-injective function of the collection elements.</p>
<div class="section" id="tuples">
<h3>Tuples<a class="headerlink" href="#tuples" title="Permalink to this headline"> &sect;</a></h3>
<p><strong>A tuple is a collection of fixed size but the values may have different types</strong>. The syntax <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">b</span></code> (seen recently for dictionaries) constructs a tuple, it is a shorthand for <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span></code>, which is more general. More generally a tuple of type <code class="docutils literal notranslate"><span class="pre">(T1,</span> <span class="pre">T2,</span> <span class="pre">…,</span> <span class="pre">Tn)</span></code> is a type containing <code class="docutils literal notranslate"><span class="pre">n</span></code> elements of type <code class="docutils literal notranslate"><span class="pre">T1</span></code>, <code class="docutils literal notranslate"><span class="pre">T2</span></code>, … and <code class="docutils literal notranslate"><span class="pre">Tn</span></code> respectively. Tuples can also be deconstructed: <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(10.0,</span> <span class="pre">20.0)</span></code> or accessed using indexes.</p>
</div>
<div class="section" id="sequences-vs-maps">
<h3>Sequences vs Maps<a class="headerlink" href="#sequences-vs-maps" title="Permalink to this headline"> &sect;</a></h3>
<p>When using collections we must differentiate between sequences and maps. <code class="docutils literal notranslate"><span class="pre">List</span></code> or <code class="docutils literal notranslate"><span class="pre">ArrayBuffer</span></code> are examples of sequences, while <code class="docutils literal notranslate"><span class="pre">Map</span></code> is not. Sequences have <code class="docutils literal notranslate"><span class="pre">.head</span></code> and <code class="docutils literal notranslate"><span class="pre">.tail</span></code> methods for the first and <strong>the rest</strong> items.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a sequence is empty both <code class="docutils literal notranslate"><span class="pre">.head</span></code> and <code class="docutils literal notranslate"><span class="pre">.tail</span></code> raise exceptions.</p>
</div>
<p>Lists are also an example of <strong>linear sequences</strong>, meaning that the <span class="math notranslate nohighlight">\(n^{th}\)</span> element requires iterating through the previous <span class="math notranslate nohighlight">\(n-1\)</span>, so accessing element at index <span class="math notranslate nohighlight">\(n\)</span>  is <span class="math notranslate nohighlight">\(\mathcal{O}(n)\)</span> operation. On the other hand, Array buffers are <strong>indexed sequences</strong>, so accessing an element at any index is <span class="math notranslate nohighlight">\(\mathcal{O}(1)\)</span> operation. Sequences can be sorted using the <code class="docutils literal notranslate"><span class="pre">.sortBy</span></code> method.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">List</span><span class="p">(</span>
  <span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="mi">42</span><span class="p">,</span>
  <span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">30</span><span class="p">,</span>
  <span class="s">&quot;Werner&quot;</span> <span class="o">-&gt;</span> <span class="mi">77</span><span class="p">,</span>
  <span class="s">&quot;Owl&quot;</span> <span class="o">-&gt;</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">sortBy</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">age</span><span class="p">)</span>
<span class="c1">// List[(String, Int)] = List((Owl, 6), (Bob, 30), (Alice, 42), (Werner, 6))</span>

<span class="n">data</span><span class="p">.</span><span class="n">sortBy</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">name</span><span class="p">)</span>
<span class="c1">// List[(String, Int)] = List((Alice, 42), (Bob, 30), (Owl, 6), (Werner, 6))</span>
</pre></div>
</div>
<p>For Maps the most relevant method is <code class="docutils literal notranslate"><span class="pre">.get</span></code> (we passed the key, and access the associated element).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">.get</span></code> returns and Option as there may not be an element associated with the passed key</p>
</div>
</div>
<div class="section" id="option">
<h3>Option<a class="headerlink" href="#option" title="Permalink to this headline"> &sect;</a></h3>
<p>Is a special collection cases that at most has one element. It is parametrized by the type of the element.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span>
  <span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="n">maybeEmail</span><span class="p">:</span> <span class="nc">Option</span><span class="p">[</span><span class="nc">String</span><span class="p">],</span>
  <span class="n">phoneNumbers</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">hasScaDotLaEmail</span><span class="p">(</span><span class="n">contact</span><span class="p">:</span> <span class="nc">Contact</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="o">=</span>
  <span class="n">contact</span><span class="p">.</span><span class="n">maybeEmail</span> <span class="k">match</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="p">.</span><span class="n">endsWith</span><span class="p">(</span><span class="s">&quot;sca.la&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="nc">None</span>        <span class="o">=&gt;</span> <span class="kc">false</span>
</pre></div>
</div>
<p>The operation <code class="docutils literal notranslate"><span class="pre">map</span></code> transforms the element in the option with the given function. <code class="docutils literal notranslate"><span class="pre">getOrElse</span></code> returns the optional value if defined, if not falls back to a given one. The operation <code class="docutils literal notranslate"><span class="pre">zip</span></code> combines two optional values into a single optional value. As seen above <code class="docutils literal notranslate"><span class="pre">get</span></code> and <code class="docutils literal notranslate"><span class="pre">find</span></code> return and Option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Scala there is a <code class="docutils literal notranslate"><span class="pre">null</span></code> value but it is not used to model optional values.</p>
</div>
</div>
<div class="section" id="loops">
<h3>Loops<a class="headerlink" href="#loops" title="Permalink to this headline"> &sect;</a></h3>
<p>3 ways of implementing loops, using factorial example:</p>
<ol class="arabic">
<li><p>Iterating on the standard collections.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
  <span class="p">(</span><span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="p">).</span><span class="n">foldLeft</span><span class="p">(</span><span class="mi">1</span><span class="p">)((</span><span class="n">result</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">result</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Imperative loops with the control structure <code class="docutils literal notranslate"><span class="pre">while</span></code>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
  <span class="kd">var</span> <span class="n">acc</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kd">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">do</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">i</span>
  <span class="n">acc</span>
</pre></div>
</div>
<p>The keywoed <code class="docutils literal notranslate"><span class="pre">var</span></code> introduces a variable definition. Unlike <code class="docutils literal notranslate"><span class="pre">val</span></code> definitions, <code class="docutils literal notranslate"><span class="pre">var</span></code> definitions can be <strong>re-assigned</strong>.</p>
</li>
<li><p>Functional loops with recursion</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span>
  <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If the chain of recursive call is too long the call stack overflows raising a <code class="docutils literal notranslate"><span class="pre">StackOverflowError</span></code>. To avoid this error, we can put the recursive call in tail position:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
  <span class="k">def</span> <span class="nf">factorialTailRec</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">accumulator</span>
    <span class="k">else</span> <span class="n">factorialTailRec</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">accumulator</span><span class="p">)</span>
  <span class="n">factorialTailRec</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">end</span> <span class="nn">factorial</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have use a special collection Range: <code class="docutils literal notranslate"><span class="pre">(begin</span> <span class="pre">to</span> <span class="pre">end</span> <span class="pre">by</span> <span class="pre">step)</span></code>.</p>
</div>
<div class="section" id="for-loop">
<h4>For loop<a class="headerlink" href="#for-loop" title="Permalink to this headline"> &sect;</a></h4>
<p><strong>For</strong> loop is really common and in Scala follows the expression: <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(</span> <span class="pre">s</span> <span class="pre">)</span> <span class="pre">yield</span> <span class="pre">e</span></code>. Where <code class="docutils literal notranslate"><span class="pre">s</span></code> is a sequence of generators and filters and <code class="docutils literal notranslate"><span class="pre">e</span></code> is an expression whose value is returned by an iteration:</p>
<ul class="simple">
<li><p>A generator is of the form <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">&lt;-</span> <span class="pre">e</span></code>, where <code class="docutils literal notranslate"><span class="pre">p</span></code>  is a pattern and <code class="docutils literal notranslate"><span class="pre">e</span></code> is an expression whose values is a collection.</p></li>
<li><p>A filter is of the form <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">f</span></code> where <code class="docutils literal notranslate"><span class="pre">f</span></code> is a boolean expression.</p></li>
<li><p>The sequence must start with a generator</p></li>
<li><p>If there are several generators in the sequence, the last generators vary faster than the first.</p></li>
</ul>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">s</span> <span class="pre">)</span></code>, the sequence of generators and filters can be written on multiple lines without requiring semicolons.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">namesAndSwissNumbers</span><span class="p">:</span> <span class="nc">List</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">)]</span> <span class="o">=</span>
  <span class="n">contacts</span><span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">contact</span> <span class="o">=&gt;</span>
    <span class="n">contact</span><span class="p">.</span><span class="n">phoneNumbers</span>
      <span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">phoneNumber</span> <span class="o">=&gt;</span> <span class="n">phoneNumber</span><span class="p">.</span><span class="n">startsWith</span><span class="p">(</span><span class="s">&quot;+41&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">phoneNumber</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">))</span>
    <span class="p">}</span>

<span class="kd">val</span> <span class="n">namesAndSwissNumbers</span><span class="p">:</span> <span class="nc">List</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">)]</span> <span class="o">=</span>
  <span class="k">for</span>
    <span class="n">contact</span>     <span class="o">&lt;-</span> <span class="n">contacts</span>
    <span class="n">phoneNumber</span> <span class="o">&lt;-</span> <span class="n">contact</span><span class="p">.</span><span class="n">phoneNumbers</span>
    <span class="k">if</span> <span class="n">phoneNumber</span><span class="p">.</span><span class="n">startsWith</span><span class="p">(</span><span class="s">&quot;+41&quot;</span><span class="p">)</span>
  <span class="k">yield</span> <span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">)</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">e</span> <span class="pre">do</span> <span class="pre">s</span></code> is also available, but it does not create a new collection, it is translated to <code class="docutils literal notranslate"><span class="pre">foreach</span></code> method.</p>
</div>
</div>
<div class="section" id="concatenating">
<h3>Concatenating<a class="headerlink" href="#concatenating" title="Permalink to this headline"> &sect;</a></h3>
<p>The usual way to concatenate collection is the <code class="docutils literal notranslate"><span class="pre">++</span></code> method, which is immutable (original collections remains unchanged). However, mutable collections as <code class="docutils literal notranslate"><span class="pre">ArrayBuffer</span></code> allow calling it using the <code class="docutils literal notranslate"><span class="pre">++=</span></code> notation that modifies LHS sequence. We can also prepend elements in a mutable way with <code class="docutils literal notranslate"><span class="pre">+=:</span></code>, all symbolic methods have alphabetic equivalents:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">updated</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">++</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">concat</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">removed</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">removedAll</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+:</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">prepended</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:+</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">appended</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+=</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">addOne</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">++=</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">addAll</span></code></p></li>
</ul>
<p>Mutable collections must be used when specific mutable operations are required.</p>
</div>
</div>
<div class="section" id="organize-code">
<h2>Organize code<a class="headerlink" href="#organize-code" title="Permalink to this headline"> &sect;</a></h2>
<p>Definitions introduce <strong>names</strong> that can be reused, which comes with drawbacks:</p>
<ol class="arabic simple">
<li><p>Collisions (or clashes) when 2 different things use the same name.</p></li>
<li><p>Coupling with the parts of code referring to the names.</p></li>
</ol>
<p><strong>Packages</strong> give a prefix to definitions:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// File areas.scala</span>
<span class="k">package</span> <span class="n">area</span>

<span class="kd">val</span> <span class="n">facade</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1">// File prices.scala</span>
<span class="k">package</span> <span class="n">price</span>

<span class="kd">val</span> <span class="n">paint</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="kd">val</span> <span class="n">facade</span> <span class="o">=</span> <span class="n">area</span><span class="p">.</span><span class="n">facade</span> <span class="o">*</span> <span class="n">paint</span>
</pre></div>
</div>
<p>To place a definition inside a package the <code class="docutils literal notranslate"><span class="pre">package</span></code> clause must be used at the top of the file. Names can be referred by their fully qualified name <code class="docutils literal notranslate"><span class="pre">areas.facade</span></code>. It is good practice put source files mirroring the packages structure (emulating Python behaviour), e.g. object <code class="docutils literal notranslate"><span class="pre">effective.example.Hello</span></code> should be defined in <cite>src/main/scala/effective/example/Hello.scala</cite>. To avoid cumbersome naming we can import names writing at the top of the file:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">effective</span><span class="p">.</span><span class="nn">example</span><span class="p">.</span><span class="nc">Hello</span>         <span class="c1">// imports just Hello</span>
<span class="k">import</span> <span class="nn">effective</span><span class="p">.</span><span class="nn">example</span><span class="p">.</span><span class="nc">Hello</span><span class="p">.</span><span class="n">foo</span>     <span class="c1">// imports just foo</span>
<span class="k">import</span> <span class="nn">effective</span><span class="p">.</span><span class="nn">example</span><span class="p">.{</span><span class="nc">Hello</span><span class="p">,</span> <span class="nc">Bar</span><span class="p">}</span>  <span class="c1">// import both Hello and Bar</span>
<span class="k">import</span> <span class="nn">effective</span><span class="p">.</span><span class="nn">example</span><span class="p">.</span><span class="n">*</span>             <span class="c1">// import everything from package:</span>
                                       <span class="c1">// effective.example</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In Scala 2 the wildcard character was “_” and not “*”.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Imports can be made either from packages or objects.</p>
</div>
<p>The definitions introduced by the standard library live in the <code class="docutils literal notranslate"><span class="pre">scala</span></code> package: <code class="docutils literal notranslate"><span class="pre">scala.util.Random</span></code>, <code class="docutils literal notranslate"><span class="pre">scala.Int</span></code> or <code class="docutils literal notranslate"><span class="pre">scala.collection.immutable.List</span></code>. Some entities are imported automatically on every Scala program.</p>
<div class="section" id="developer-workflow">
<h3>Developer Workflow<a class="headerlink" href="#developer-workflow" title="Permalink to this headline"> &sect;</a></h3>
<p>Compile a program consists of invoking the compiler on all source files turning them into executable JVM bytecode. It requires:</p>
<ul class="simple">
<li><p>Constructing the application classpath by fetching library dependencies.</p></li>
<li><p>Generating parts of the source code or resources (assets, data types, …).</p></li>
</ul>
<p><strong>Build tools</strong> manage compilation tasks for you:</p>
<div class="section" id="sbt">
<h4>sbt<a class="headerlink" href="#sbt" title="Permalink to this headline"> &sect;</a></h4>
<p><a class="reference external" href="https://www.scala-sbt.org/">sbt</a> is the most commonly build tool used in Scala, but not the only one: Maven, Gradle, Mill, … are other possibilities. An sbt project is a directory with 2 files: <cite>project/build.properties</cite> and <cite>build.sbt</cite>. The first one defines the version of sbt used to compile the project, while the second defines the Scala version and other project details. After compiling a project results are cached at <cite>target</cite> directory. <strong>sbt is an incremental compiling tool</strong>. A brief example of an execution diagram would be:</p>
<a class="reference internal image-reference" href="../../_images/sbt_diagram.PNG"><img alt="sbt diagram" src="../../_images/sbt_diagram.PNG" style="width: 80%;" /></a>
<p>We can identify <strong>settings</strong> marked as grey rectangles and parametrized in build, which are evaluated once and <strong>tasks</strong> marked as blue rectangles and evaluated at each invocation. <strong>Tasks</strong> are parametrized by settings, values and other  tasks.</p>
<p>sbt also automates testing. When defining library dependencies on <cite>build.sbt</cite> file we can add <code class="docutils literal notranslate"><span class="pre">Test</span></code> to library dependency to specify that is only required for testing:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">&quot;3.0.0&quot;</span>
<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.scalameta&quot;</span> <span class="o">%%</span> <span class="s">&quot;munit&quot;</span> <span class="o">%</span> <span class="s">&quot;0.7.26&quot;</span> <span class="o">%</span> <span class="nc">Test</span>
</pre></div>
</div>
<p>Test are under <cite>test</cite> folder inside <cite>src</cite> replicating the structure of the package under <cite>main</cite>.</p>
<p>Additional tasks are provided by <strong>plugins</strong>.</p>
<p>Key concept when using sbt is the <strong>source directory</strong>, directory under which compiler will look for the code to run. Keys can be assign a value along a configuration such as <code class="docutils literal notranslate"><span class="pre">Compile</span></code>, <code class="docutils literal notranslate"><span class="pre">Test</span></code> or no specific configuration (a.k.a. <code class="docutils literal notranslate"><span class="pre">Zero</span></code>). If no configuration is specified sbt tries <code class="docutils literal notranslate"><span class="pre">Compile</span></code> and falls back to <code class="docutils literal notranslate"><span class="pre">Test</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">run</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">Compile</span> <span class="pre">/</span> <span class="pre">run</span></code>. If a key has no value in a specific scope, sbt fall back to a more generic one. When project contains sub-projects they can also be used to assign values to sbt keys, special sub-project named <code class="docutils literal notranslate"><span class="pre">ThisBuild</span></code> so settings applies to entire build, for example, setting the Scala version for all sub-projects: <code class="docutils literal notranslate"><span class="pre">ThisBuild</span> <span class="pre">/</span> <span class="pre">scalaVersion</span> <span class="pre">:=</span> <span class="pre">&quot;3.0.0&quot;</span></code>. Check value of key <code class="docutils literal notranslate"><span class="pre">includeFilter</span></code> according to multiple axes:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// current project, no configuration, unmanagedSource task</span>
<span class="n">unmanagedSources</span> <span class="o">/</span> <span class="n">includeFilter</span>
<span class="c1">// hello-sbt project, no configuration, unmanagedSource task</span>
<span class="n">hello</span><span class="o">-</span><span class="n">sbt</span> <span class="n">project</span> <span class="o">/</span> <span class="n">unmanagedSources</span> <span class="o">/</span> <span class="n">includeFilter</span>
<span class="c1">// hello-sbt project, Compile configuration, unmanagedSource task</span>
<span class="n">hello</span><span class="o">-</span><span class="n">sbt</span> <span class="o">/</span> <span class="nc">Compile</span> <span class="o">/</span> <span class="n">unmanagedSources</span> <span class="o">/</span> <span class="n">includeFilter</span>
</pre></div>
</div>
</div>
<div class="section" id="program-entry-point">
<h4>Program entry point<a class="headerlink" href="#program-entry-point" title="Permalink to this headline"> &sect;</a></h4>
<p>Scala worksheets are evaluated line by line from top to bottom. A program is evaluated by calling its “entry point” which is a method located in an arbitrary source file. The entry point is a method annotated with <code class="docutils literal notranslate"><span class="pre">&#64;main</span></code>, and method arguments must be provided. Basic types are accepted.</p>
</div>
</div>
<div class="section" id="encapsulation">
<h3>Encapsulation<a class="headerlink" href="#encapsulation" title="Permalink to this headline"> &sect;</a></h3>
<p>Following code example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DatabaseAccess</span><span class="p">(</span><span class="n">connection</span><span class="p">:</span> <span class="nc">Connection</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="p">():</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Data</span><span class="p">]</span> <span class="o">=</span>
    <span class="p">...</span>
    <span class="n">connection</span><span class="p">...</span>
    <span class="p">...</span>
</pre></div>
</div>
<p>Defines a <strong>type</strong> and a <strong>constructor</strong> with the same name. Type <code class="docutils literal notranslate"><span class="pre">DatabaseAccess</span></code> has also a method <code class="docutils literal notranslate"><span class="pre">readData</span></code>. <strong>Constructor parameters of “simple” classes are private</strong>, can only be accessed from class body (which is not the case for case classes). So <strong>case classes achieve aggregation while “simple” classes achieve encapsulation</strong>. By default class members are <strong>public</strong>, but they can also be private, if defined like <code class="docutils literal notranslate"><span class="pre">private</span> <span class="pre">def</span></code>, so would only be accessible from inside class body.</p>
<p>In case we need different implementations of the same method we can define and <strong>interface</strong> as follows:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">DatabaseAccess</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="p">():</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Data</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">PersistentDatabase</span><span class="p">(</span><span class="n">connection</span><span class="p">:</span> <span class="nc">Connection</span><span class="p">)</span> <span class="k">extends</span> <span class="nc">DatabaseAccess</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="p">():</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Data</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>

<span class="k">class</span> <span class="nc">InMemoryDatabase</span> <span class="k">extends</span> <span class="nc">DatabaseAccess</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="p">():</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Data</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>
</pre></div>
</div>
<p>This defines a type <code class="docutils literal notranslate"><span class="pre">DatabaseAccess</span></code> but no constructor. The type has one <strong>abstract method</strong>. Unlike <strong>sealed traits</strong>, “simple” traits can have an unbounded number of implementations. If a class that extends a trait does not implement its methods, we got a compilation error. If a method is implemented on father, it can be override explicitly using <code class="docutils literal notranslate"><span class="pre">override</span> <span class="pre">def</span></code>. We can also use <code class="docutils literal notranslate"><span class="pre">super</span></code> to access parent implementation. To avoid method override we can used <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">def</span></code> where <code class="docutils literal notranslate"><span class="pre">this</span></code> keyword is used to refer to the concrete instance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multiple inheritance is allowed.</p>
</div>
<p>Third visibility is defined as <strong>protected</strong> for members that can be accessed from inside trait or class and inside of its descendants but not from outside and are defined with <code class="docutils literal notranslate"><span class="pre">protected</span> <span class="pre">def</span></code>.</p>
<p>Standard collections is a reach hierarchy example:</p>
<a class="reference internal image-reference" href="../../_images/collections.PNG"><img alt="collections hierarchy" src="../../_images/collections.PNG" style="width: 50%;" /></a>
<p>At the top of the hierarchy is the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p>
<div class="section" id="case-classes-vs-simple-classes">
<h4>Case classes vs “Simple” classes<a class="headerlink" href="#case-classes-vs-simple-classes" title="Permalink to this headline"> &sect;</a></h4>
<p>As indicated above, case classes are for aggregation whereas “simple” classes are for encapsulation. This means that case classes parameters are promoted to public members while constructor parameters of “simple” classes remain private (by default). It can be consider that a case class is a special case of a “simple” class. When a case class is defined:</p>
<ul class="simple">
<li><p>Constructor parameters are promoted to public members.</p></li>
<li><p>An extractor enables pattern matching.</p></li>
<li><p>Equality operator between instances compares the values of the case class fields.</p></li>
</ul>
<p>When both case or “simple” class are defined:</p>
<ul class="simple">
<li><p>Define a new type along with a constructor.</p></li>
<li><p>Can have public and private members.</p></li>
<li><p>Can extend traits and override members.</p></li>
<li><p>Create abstraction levels.</p></li>
</ul>
</div>
<div class="section" id="sealed-traits-vs-simple-traits">
<h4>Sealed traits vs “Simple” traits<a class="headerlink" href="#sealed-traits-vs-simple-traits" title="Permalink to this headline"> &sect;</a></h4>
<p>Sealed traits have a fixed number of concrete subclasses and they have to be defined in the same file as the sealed trait. So <strong>exhaustively checking pattern matching</strong> is only possible with sealed traits. Despite those, both sealed and “simple” traits:</p>
<ul class="simple">
<li><p>Define a new type with no constructor.</p></li>
<li><p>Can have concrete abstract members.</p></li>
<li><p>Can have public, protected and private members.</p></li>
<li><p>Create abstraction levels.</p></li>
</ul>
<p>Case classes and sealed traits are about <strong>sets of possible values</strong>, e.g. type <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> has 2 possible values, type <code class="docutils literal notranslate"><span class="pre">Option[Boolean]</span></code> has 3, etc. On the other hand, “simple” traits and classes act like interfaces that provide a specific set of operations, e.g. the type <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> has logic operations like <code class="docutils literal notranslate"><span class="pre">||</span></code> or <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code>.</p>
</div>
<div class="section" id="opaque-type-aliases">
<h4>Opaque type aliases<a class="headerlink" href="#opaque-type-aliases" title="Permalink to this headline"> &sect;</a></h4>
<p>Imagine the following situation:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span>
  <span class="o">???</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Vehicle</span><span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span>
  <span class="o">???</span>
</pre></div>
</div>
<p>Further in our code we cannot differentiate between <code class="docutils literal notranslate"><span class="pre">User.id</span></code> and <code class="docutils literal notranslate"><span class="pre">Vehicle.id</span></code> as they are both the same type. So we have to differentiate these types:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">UserID</span> <span class="k">private</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Long</span><span class="p">)</span>
<span class="k">object</span> <span class="nc">UserID</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Option</span><span class="p">[</span><span class="nc">UserID</span><span class="p">]</span> <span class="o">=</span>
    <span class="n">string</span><span class="p">.</span><span class="n">toLongOption</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">id</span> <span class="o">=&gt;</span> <span class="nc">UserID</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
</pre></div>
</div>
<p>Here the type <code class="docutils literal notranslate"><span class="pre">UserID</span></code> is public but the constructor es private. The only way to construct a value of type <code class="docutils literal notranslate"><span class="pre">UserID</span></code> is calling operation <code class="docutils literal notranslate"><span class="pre">UserID.parse</span></code>. This is a possible solution but it is a bit overkill, in this situation <strong>type aliases</strong> are the proper solution:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="nc">UserID</span> <span class="o">=</span> <span class="nc">Long</span>
<span class="k">object</span> <span class="nc">UserID</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Option</span><span class="p">[</span><span class="nc">UserID</span><span class="p">]</span> <span class="o">=</span>
    <span class="n">string</span><span class="p">.</span><span class="n">toLongOption</span>
</pre></div>
</div>
<p>Type aliases incur no runtime costs, and are interchangeable with the type they are an alias to so this do not solve the problem, <strong>opaque type aliases</strong> do:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">UserID</span><span class="p">:</span>
  <span class="k">opaque</span> <span class="k">type</span> <span class="nc">UserID</span> <span class="o">=</span> <span class="nc">Long</span>
<span class="k">object</span> <span class="nc">VehicleID</span><span class="p">:</span>
  <span class="k">opaque</span> <span class="k">type</span> <span class="nc">VehicleID</span> <span class="o">=</span> <span class="nc">Long</span>

<span class="k">import</span> <span class="nc">UserID</span><span class="p">.</span><span class="nc">UserID</span>
<span class="k">import</span> <span class="nc">VehicleID</span><span class="p">.</span><span class="nc">VehicleID</span>
<span class="k">def</span> <span class="nf">findVehicle</span><span class="p">(</span><span class="n">vehicleID</span><span class="p">:</span> <span class="nc">VehicleID</span><span class="p">):</span> <span class="nc">Option</span><span class="p">[</span><span class="nc">Vehicle</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>
<span class="k">def</span> <span class="nf">mistake</span><span class="p">(</span><span class="n">userID</span><span class="p">:</span> <span class="nc">UserID</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span>
  <span class="n">findVehicle</span><span class="p">(</span><span class="n">userID</span><span class="p">)</span>
              <span class="o">^^^^^^</span>
              <span class="nc">Found</span><span class="p">:</span>    <span class="p">(</span><span class="n">userID</span><span class="p">:</span> <span class="nc">UserID</span><span class="p">.</span><span class="nc">UserID</span><span class="p">)</span>
              <span class="nc">Required</span><span class="p">:</span> <span class="nc">VehicleID</span><span class="p">.</span><span class="nc">VehicleID</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Opaque type aliases incur no runtime overhead.</p></li>
<li><p>Inside the scope of the alias definition the alias is transparent.</p></li>
<li><p>Outside the scope the alias is opaque (hides the type it aliases).</p></li>
</ul>
<p>Complete example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Lengths</span><span class="p">:</span>
  <span class="k">opaque</span> <span class="k">type</span> <span class="nc">Meters</span> <span class="o">=</span> <span class="nc">Double</span>
  <span class="k">def</span> <span class="nf">Meters</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span> <span class="nc">Meters</span> <span class="o">=</span> <span class="n">value</span>
  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Meters</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Meters</span><span class="p">):</span> <span class="nc">Meters</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Meters</span><span class="p">):</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">s&quot;</span><span class="si">$</span><span class="n">x</span><span class="s"> m&quot;</span>

<span class="k">def</span> <span class="nf">usage</span><span class="p">():</span> <span class="nc">Unit</span> <span class="o">=</span>
  <span class="k">import</span> <span class="nc">Lengths</span><span class="p">.</span><span class="n">*</span>
  <span class="kd">val</span> <span class="n">twoMeters</span><span class="p">:</span> <span class="nc">Meters</span> <span class="o">=</span> <span class="nc">Meters</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">fourMeters1</span><span class="p">:</span> <span class="nc">Double</span> <span class="o">=</span> <span class="n">twoMeters</span> <span class="o">+</span> <span class="n">twoMeters</span>     <span class="c1">// ERROR!</span>
  <span class="n">println</span><span class="p">(</span><span class="n">show</span><span class="p">(</span><span class="n">fourMeters1</span><span class="p">))</span>                          <span class="c1">// ERROR!</span>
  <span class="kd">val</span> <span class="n">fourMeters2</span><span class="p">:</span> <span class="nc">Double</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">twoMeters</span><span class="p">,</span> <span class="n">twoMeters</span><span class="p">)</span> <span class="c1">// ERROR!</span>
  <span class="kd">val</span> <span class="n">fourMeters3</span><span class="p">:</span> <span class="nc">Meters</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">twoMeters</span><span class="p">,</span> <span class="n">twoMeters</span><span class="p">)</span>
  <span class="n">println</span><span class="p">(</span><span class="n">show</span><span class="p">(</span><span class="n">fourMeters3</span><span class="p">))</span>
</pre></div>
</div>
<p>Since opaque types have no methods, auxiliary ones need to be defined to work with them. In this case <strong>extensions methods</strong> become really useful:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">UserID</span><span class="p">:</span>
  <span class="k">opaque</span> <span class="k">type</span> <span class="nc">UserID</span> <span class="o">=</span> <span class="nc">Long</span>
  <span class="k">extension</span> <span class="p">(</span><span class="n">userID</span><span class="p">:</span> <span class="nc">UserID</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">:</span> <span class="nc">Long</span> <span class="o">=</span> <span class="n">userID</span>
</pre></div>
</div>
<p>This way the <code class="docutils literal notranslate"><span class="pre">UserID.value</span></code> can be accessed directly (similar to Python properties). So <code class="docutils literal notranslate"><span class="pre">extension</span> <span class="pre">&lt;type&gt;</span> <span class="pre">def</span> <span class="pre">&lt;method</span> <span class="pre">tag&gt;(&lt;method</span> <span class="pre">parameters&gt;):</span> <span class="pre">&lt;resulting</span> <span class="pre">type&gt;</span> <span class="pre">=</span> <span class="pre">&lt;method</span> <span class="pre">definition&gt;</span></code> is translated by the compiler similar to <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">&lt;method</span> <span class="pre">tag&gt;(&lt;type&gt;)(&lt;method</span> <span class="pre">parameters&gt;):</span> <span class="pre">&lt;resulting</span> <span class="pre">type&gt;</span> <span class="pre">=</span> <span class="pre">&lt;method</span> <span class="pre">definition&gt;</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">extension</span> <span class="pre">(n:</span> <span class="pre">Int)</span> <span class="pre">def</span> <span class="pre">**</span> <span class="pre">(e:</span> <span class="pre">Int):</span> <span class="pre">Double</span> <span class="pre">=</span> <span class="pre">Math.pow(n,</span> <span class="pre">e)</span></code> can be used <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">4</span> <span class="pre">//</span> <span class="pre">16</span></code> or <code class="docutils literal notranslate"><span class="pre">**(2)(4)</span> <span class="pre">//</span> <span class="pre">16</span></code>. If a method <code class="docutils literal notranslate"><span class="pre">m</span></code> is not defined for expression <code class="docutils literal notranslate"><span class="pre">e</span></code> of type <code class="docutils literal notranslate"><span class="pre">E</span></code>, compiler tries to rewrite the call into <code class="docutils literal notranslate"><span class="pre">m(e)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Compiler looks for extension methods in scope of definition of opaque types</p>
</div>
</div>
</div>
</div>
<div class="section" id="code-reasoning">
<h2>Code reasoning<a class="headerlink" href="#code-reasoning" title="Permalink to this headline"> &sect;</a></h2>
<p>The usual strategy to manage complexity consists of breaking down complex programs into smaller ones, and combine those. This strategy is not effective if local reasoning is not possible (i.e. combining programs requires knowledge about their internals).</p>
<p>Operations that, in addition to returning a value also “do something” out of the control of the program have <strong>side-effects</strong> and must be handled carefully. They are classified as:</p>
<ul class="simple">
<li><p>Operations that modify program state</p></li>
<li><p>Operations that communicate with the “outside world”</p></li>
</ul>
<p>Operations that only describe what should result based on a set of input parameters are always refactoring-proof (also called purely functional or referentially transparent).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When defining with <code class="docutils literal notranslate"><span class="pre">def</span></code> definition is called every time is used.</p>
</div>
<p>“Pure” alternatives to side-effects introduce accidental complexity by requiring developers to explicitly carry over the context the operate on.</p>
<p>Plain classes equality is checked by comparing the “identity” of their instances whereas case classes equality is checked by comparing the values carried by their instances. It is good practice prefer immutable data types over mutable ones.</p>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline"> &sect;</a></h3>
<p>Reading a code base requires too much effort to reason about a whole program and type system ensures correct combination of parts but relies on the assumption of correctly modeled things. <strong>Unit testing</strong> consists of calling a program with inputs for which expected result is well known. Imagine a package:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// FILE src/main/scala/testexample/Program.scala</span>
<span class="k">package</span> <span class="n">testexample</span>

<span class="cm">/** @return the sum of &#39;x&#39; and &#39;y&#39; */</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="cm">/** @return the &#39;n&#39;th Fibonacci number (starting from 0) */</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">then</span> <span class="n">n</span>
  <span class="k">else</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>To test it we have to add to <code class="docutils literal notranslate"><span class="pre">build.sbt</span></code> file:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.scalameta&quot;</span> <span class="o">%%</span> <span class="s">&quot;munit&quot;</span> <span class="o">%</span> <span class="s">&quot;0.7.19&quot;</span> <span class="o">%</span> <span class="nc">Test</span>
<span class="n">testFrameworks</span> <span class="o">+=</span> <span class="k">new</span> <span class="nc">TestFramework</span><span class="p">(</span><span class="s">&quot;munit.Framework&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// FILE src/test/scala/testexample/Program.scala</span>
<span class="k">package</span> <span class="n">testexample</span>

<span class="k">class</span> <span class="nc">ProgramSuite</span> <span class="k">extends</span> <span class="n">munit</span><span class="p">.</span><span class="nc">FunSuite</span><span class="p">:</span>
  <span class="n">test</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="n">obtained</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">val</span> <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">obtained</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">test</span><span class="p">(</span><span class="s">&quot;fibonacci&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="n">obtained</span> <span class="o">=</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kd">val</span> <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">obtained</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span> <span class="nc">ProgramSuite</span>
</pre></div>
</div>
<p>When writing unit test is a good practice to check all the corner cases.</p>
</div>
<div class="section" id="property-based">
<h3>Property based<a class="headerlink" href="#property-based" title="Permalink to this headline"> &sect;</a></h3>
<p>Generally, it would be impossible to write test cases manually for the whole domain space. Alternative approach is to generate random input data, in which case we can only specify general <strong>properties</strong> that must be correct for all possible inputs, e.g. in the above <code class="docutils literal notranslate"><span class="pre">fibonacci</span></code> method the output for any number must be the sum of the outputs for the 2 previous numbers.</p>
<p>In this case the library required is ScalaCheck, which comes integrated with MUnit, so following lines would be needed:</p>
<blockquote>
<div><p>libraryDependencies += “org.scalameta” %% “munit-scalacheck” % “0.7.19” % Test
testFrameworks += new TestFramework(“munit.Framework”)</p>
</div></blockquote>
<p>Considering that the input must be greater than 2, the test would be written:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// FILE src/test/scala/testexample/Program.scala</span>
<span class="k">package</span> <span class="n">testexample</span>

<span class="k">import</span> <span class="nn">org</span><span class="p">.</span><span class="nn">scalacheck</span><span class="p">.</span><span class="nc">Prop</span><span class="p">.</span><span class="n">forAll</span>

<span class="k">class</span> <span class="nc">ProgramProperties</span> <span class="k">extends</span> <span class="n">munit</span><span class="p">.</span><span class="nc">ScalaCheckSuite</span><span class="p">:</span>
  <span class="kd">val</span> <span class="n">fibonacciDomain</span><span class="p">:</span> <span class="nc">Gen</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Gen</span><span class="p">.</span><span class="n">choose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nc">Int</span><span class="p">.</span><span class="nc">MaxValue</span><span class="p">)</span>

  <span class="n">property</span><span class="p">(</span><span class="s">&quot;fibonacci(n) == fibonacci(n-1) + fibonacci(n-1)&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Alternative to fibonacciDomain ≡ n =&gt; n &gt;= 2</span>
    <span class="n">forAll</span><span class="p">(</span><span class="n">fibonacciDomain</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">property</span><span class="p">(</span><span class="s">&quot;fibonacci numbers are positive&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">forAll</span> <span class="p">{</span> <span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="k">end</span> <span class="nc">ProgramProperties</span>
</pre></div>
</div>
<p>Properties refer to <strong>invariants</strong> and <strong>identities</strong> of the code, it is important to not reimplement the system when testing.</p>
</div>
<div class="section" id="mocking">
<h3>Mocking<a class="headerlink" href="#mocking" title="Permalink to this headline"> &sect;</a></h3>
<p>In a system made of components, one of them may depend on others, but, how do we test one component without having to set up all components?. Solution: <strong>Mock</strong> required components. Mocking consists in providing a fake implementation of a component. One example would be the <code class="docutils literal notranslate"><span class="pre">DatabaseAccess</span></code> example used above. However, this solution could become unaffordable, so we can use a mocking library such as ScalaMock, which uses advanced techniques available on the JVM to create fake component implementations (TODO: mastering these is out of the scope of this course).</p>
</div>
<div class="section" id="integration-testing">
<h3>Integration testing<a class="headerlink" href="#integration-testing" title="Permalink to this headline"> &sect;</a></h3>
<p>Integration refers the testing of the complete system as new problems can arise when assembling parts together. With MUnit we can set up and shut down a resource for the lifetime of a single test.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HttpServerSuite</span> <span class="k">extends</span> <span class="n">munit</span><span class="p">.</span><span class="nc">FunSuite</span><span class="p">:</span>
  <span class="kd">val</span> <span class="n">withHttpServer</span> <span class="o">=</span> <span class="nc">FunFixture</span><span class="p">[</span><span class="nc">HttpServer</span><span class="p">](</span>
    <span class="n">setup</span> <span class="o">=</span> <span class="n">test</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="n">httpServer</span> <span class="o">=</span> <span class="nc">HttpServer</span><span class="p">()</span>
      <span class="n">httpServer</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
      <span class="n">httpServer</span>
    <span class="p">},</span>
    <span class="n">teardown</span> <span class="o">=</span> <span class="n">httpServer</span> <span class="o">=&gt;</span> <span class="n">httpServer</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
  <span class="p">)</span>

  <span class="n">withHttpServer</span><span class="p">.</span><span class="n">test</span><span class="p">(</span><span class="s">&quot;server is running&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">httpServer</span> <span class="o">=&gt;</span>
    <span class="c1">// Perform HTTP request here</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>To setup the stack once at the beginning and shut down at the end override is needed:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HttpServerSuite</span> <span class="k">extends</span> <span class="n">munit</span><span class="p">.</span><span class="nc">FunSuite</span><span class="p">:</span>
  <span class="kd">val</span> <span class="n">httpServer</span> <span class="o">=</span> <span class="nc">HttpServer</span><span class="p">()</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">beforeAll</span><span class="p">():</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="n">httpServer</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">afterAll</span><span class="p">():</span> <span class="nc">Unit</span>  <span class="o">=</span> <span class="n">httpServer</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>

  <span class="c1">// Write tests here the usual way</span>
</pre></div>
</div>
<p>Compiler plugin scoverage enables test coverage. In Scala <strong>tests are written before implementing a bugfix</strong> so not yet fixed program should not pass the test and after fix it should be passed.</p>
</div>
<div class="section" id="type-directed-programming">
<h3>Type-Directed Programming<a class="headerlink" href="#type-directed-programming" title="Permalink to this headline"> &sect;</a></h3>
<p>As the compiler is able to infer types from values it is also able to infer values from types (when there is exactly one “obvious” value for a type).</p>
<p>A method is polymorphic when it can adapt to different types of inputs, like <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">sort[A](xs:</span> <span class="pre">List[A]):</span> <span class="pre">List[A]</span></code>. For further parameters that adapt the method to different types, compiler can infer their value, if we:</p>
<ol class="arabic">
<li><p>Let the compiler know that it is expected to pass the argument.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sort</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">xs</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">])(</span><span class="k">using</span> <span class="n">ord</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>

<span class="kd">val</span> <span class="n">xs</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>

<span class="n">sort</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="c1">// This is valid now!</span>
</pre></div>
</div>
<p>Parameter of <strong>using clause</strong> can be freely mixed with an also be anonymous (used when context parameter is passed as a context argument for further methods). There is also alternative syntax: <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">sort[A:</span> <span class="pre">Ordering](xs:</span> <span class="pre">List[A]):</span> <span class="pre">List[A]</span></code> ≡ <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">sort[A](xs:</span> <span class="pre">List[A])(using</span> <span class="pre">Ordering[A]):</span> <span class="pre">List[A]</span></code> (parameter <code class="docutils literal notranslate"><span class="pre">A</span></code> has a context bound <code class="docutils literal notranslate"><span class="pre">Ordering</span></code>).</p>
</li>
<li><p>Provide candidate values for such arguments using <strong>given instances</strong> to evaluate context parameters which are defined as follows:</p></li>
</ol>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Ordering</span><span class="p">:</span>
  <span class="k">given</span> <span class="nc">Int</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="k">with</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1">// Alternatively</span>
<span class="k">object</span> <span class="nc">IntOrdering</span> <span class="k">extends</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]:</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
<span class="k">given</span> <span class="n">intOrdering</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="o">=</span> <span class="nc">IntOrdering</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As there is no universal way of comparing values of type <code class="docutils literal notranslate"><span class="pre">A</span></code>, we cannot use something like <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">y</span></code> in our code. scala.math.Ordering[A] provides way to compare elements of type <code class="docutils literal notranslate"><span class="pre">A</span></code></p>
</div>
<p>Complete example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">a1</span><span class="p">:</span> <span class="nc">A</span><span class="p">,</span> <span class="n">a2</span><span class="p">:</span> <span class="nc">A</span><span class="p">):</span> <span class="nc">Int</span>

<span class="k">object</span> <span class="nc">Ordering</span><span class="p">:</span>
  <span class="k">given</span> <span class="nc">Int</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="k">with</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span> <span class="p">...</span>
  <span class="k">given</span> <span class="nc">String</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="k">with</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span> <span class="p">...</span>

<span class="k">def</span> <span class="nf">sort</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">as</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">])(</span><span class="k">using</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>

<span class="n">sort</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>           <span class="c1">// : List[Int]    = List(1, 2, 3)</span>
<span class="n">sort</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="s">&quot;banana&quot;</span><span class="p">,</span> <span class="s">&quot;apple&quot;</span><span class="p">))</span> <span class="c1">// : List[String] = List(&quot;apple&quot;, &quot;banana&quot;)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To achieve <strong>polymorphism</strong> we could also use <em>subtyping</em> (defining <code class="docutils literal notranslate"><span class="pre">Comparable</span></code> trait in this example) and then specializing method behaviour. In Scala <strong>type classes are often preferred over subtyping</strong></p>
</div>
<p>Importing given objects requires special syntax <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">scala.math.Ordering.Int</span></code> or <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">scala.math.Ordering.{given</span> <span class="pre">Ordering[Int]}</span></code> imports specific given instance. General imports can be made with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">scala.math.Ordering.{given</span> <span class="pre">Ordering[?]}</span></code> or, preferably, <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">scala.math.Ordering.given</span></code>.</p>
<p>The search scope for a given instance of type <code class="docutils literal notranslate"><span class="pre">T</span></code> includes:</p>
<ul class="simple">
<li><p>All the given instances that are visible.</p></li>
<li><p>Instances found in any companion object associated with <code class="docutils literal notranslate"><span class="pre">T</span></code> (<code class="docutils literal notranslate"><span class="pre">T</span></code> itself, inherited types, type arguments of <code class="docutils literal notranslate"><span class="pre">T</span></code> and if <code class="docutils literal notranslate"><span class="pre">T</span></code> is an inner class, the outer objects)</p></li>
</ul>
<p>Example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Foo</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>
<span class="k">trait</span> <span class="nc">Bar</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span> <span class="k">extends</span> <span class="nc">Foo</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>
<span class="k">trait</span> <span class="nc">Baz</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span> <span class="k">extends</span> <span class="nc">Bar</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>
<span class="k">trait</span> <span class="nc">X</span>
<span class="k">trait</span> <span class="nc">Y</span> <span class="k">extends</span> <span class="nc">X</span>
</pre></div>
</div>
<p>If instance of type <code class="docutils literal notranslate"><span class="pre">Bar[Y]</span></code> is required, the compiler will look into the companion objects <code class="docutils literal notranslate"><span class="pre">Bar</span></code>, <code class="docutils literal notranslate"><span class="pre">Y</span></code>, <code class="docutils literal notranslate"><span class="pre">Foo</span></code> and <code class="docutils literal notranslate"><span class="pre">X</span></code> (but no <code class="docutils literal notranslate"><span class="pre">Baz</span></code>). Given instances are searched in the enclosing <strong>lexical scope</strong> as well as in the <strong>companion objects</strong>. <strong>There has to be a unique instance matching the queried type</strong>.</p>
<p>Several given instances matching same type do not generate ambiguity if one is more specific than the others. <code class="docutils literal notranslate"><span class="pre">given</span> <span class="pre">a:</span> <span class="pre">A</span></code> is more specific than <code class="docutils literal notranslate"><span class="pre">given</span> <span class="pre">b:</span> <span class="pre">B</span></code> if:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> is in a closer lexical scope than <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> is defined in a class or object which is a subclass of the class defining  <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">A</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">A</span></code> has more fixed parts than <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p></li>
</ul>
<p>Finally, conditional given instances are also available:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sort</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">xs</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">])</span> <span class="n">using</span> <span class="n">ordering</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span>
<span class="k">given</span> <span class="n">orderingList</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="k">using</span> <span class="n">ordering</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">]]</span> <span class="k">with</span>
  <span class="p">...</span>

<span class="kd">val</span> <span class="n">xss</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">List</span><span class="p">[</span><span class="nc">Int</span><span class="p">]]</span>
<span class="n">sort</span><span class="p">[</span><span class="nc">List</span><span class="p">[</span><span class="nc">Int</span><span class="p">]](</span><span class="n">xss</span><span class="p">)(</span><span class="k">using</span> <span class="n">orderingList</span><span class="p">[</span><span class="nc">Int</span><span class="p">](</span><span class="k">using</span> <span class="nc">Ordering</span><span class="p">.</span><span class="nc">Int</span><span class="p">))</span>
</pre></div>
</div>
<p>An arbitrary number of given definitions can be chained until a terminal definition is reached.</p>
<div class="section" id="scala-3-vs-scala-2">
<h4>Scala 3 vs. Scala 2<a class="headerlink" href="#scala-3-vs-scala-2" title="Permalink to this headline"> &sect;</a></h4>
<p>In Scala 2 context parameters use the keyword <code class="docutils literal notranslate"><span class="pre">implicit</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// Scala 3</span>
<span class="k">def</span> <span class="nf">sort</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">as</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">])(</span><span class="k">using</span> <span class="n">ordering</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>

<span class="c1">// Scala 2</span>
<span class="k">def</span> <span class="nf">sort</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">as</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">])(</span><span class="k">implicit</span> <span class="n">ordering</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span> <span class="nc">List</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>
</pre></div>
</div>
<p>In Scala 2 given definition were achieved marking regular definitions (<code class="docutils literal notranslate"><span class="pre">val</span></code>, <code class="docutils literal notranslate"><span class="pre">def</span></code> or <code class="docutils literal notranslate"><span class="pre">object</span></code>) with quantifier <code class="docutils literal notranslate"><span class="pre">implicit</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// Scala 3</span>
<span class="k">given</span> <span class="n">orderingInt</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="k">with</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1">// Scala 2</span>
<span class="k">implicit</span> <span class="k">object</span> <span class="nc">orderingInt</span> <span class="k">extends</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="c1">// ... or</span>
<span class="k">implicit</span> <span class="kd">val</span> <span class="n">orderingInt</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="o">=</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In Scala 2 conditional givens were defined by an <code class="docutils literal notranslate"><span class="pre">implicit</span> <span class="pre">def</span></code> with <code class="docutils literal notranslate"><span class="pre">implicit</span></code> parameters:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// Scala 3</span>
<span class="k">given</span> <span class="n">orderingPair</span><span class="p">[</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">](</span>
    <span class="k">using</span> <span class="n">ordA</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">],</span> <span class="n">ordB</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">B</span><span class="p">]):</span> <span class="nc">Ordering</span><span class="p">[(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">)]</span> <span class="k">with</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">),</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">))</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// Scala 2</span>
<span class="k">implicit</span> <span class="k">def</span> <span class="nf">orderingPair</span><span class="p">[</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">](</span>
    <span class="k">implicit</span> <span class="n">ordA</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">],</span> <span class="n">ordB</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">B</span><span class="p">]):</span> <span class="nc">Ordering</span><span class="p">[(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">)]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ordering</span><span class="p">[(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">)]</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">),</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">))</span> <span class="o">=</span> <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="extension-methods">
<h4>Extension methods<a class="headerlink" href="#extension-methods" title="Permalink to this headline"> &sect;</a></h4>
<p><strong>Extension methods</strong> allow to add methods to a type outside the type definition, e.g., to add the <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> operation to any type <code class="docutils literal notranslate"><span class="pre">A</span></code> for which there is a given <code class="docutils literal notranslate"><span class="pre">Ordering[A]</span></code> instance:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">]:</span>
  <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">A</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">A</span><span class="p">):</span> <span class="nc">Int</span>
  <span class="k">extension</span> <span class="p">(</span><span class="n">lhs</span><span class="p">:</span> <span class="nc">A</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">&lt;</span> <span class="p">(</span><span class="n">rhs</span><span class="p">:</span> <span class="nc">A</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="o">=</span> <span class="n">compare</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>They are applicable if they are visible or the are defined in a companion object associated with the type <code class="docutils literal notranslate"><span class="pre">T</span></code> or if they are defined in a given instance associated with the type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</div>
<div class="section" id="implicit-conversions">
<h4>Implicit conversions<a class="headerlink" href="#implicit-conversions" title="Permalink to this headline"> &sect;</a></h4>
<p><strong>Implicit conversions</strong> make it possible to convert an expression to a different type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Scala supports a syntax similar to Python for repeated parameters like <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">printSquares(xs:</span> <span class="pre">Int*)</span></code> so repeated parameters can only appear at the end of parameter list.</p>
</div>
</div>
</div>
</div>
<div class="section" id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline"> &sect;</a></h2>
<p>Possible errors when running a program come from inputs (so user can fix), programming (so programmer can fix) and hardware/external (someone else’s can fix).</p>
<p>Exceptions can be thrown at any point of the execution of the program, <strong>interrupting the execution unless they are caught by a surrounding exception handler</strong>. In Scala exceptions are raised using <code class="docutils literal notranslate"><span class="pre">throw</span></code> expression:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">attemptSomething</span><span class="p">():</span> <span class="nc">Unit</span> <span class="o">=</span>
  <span class="n">println</span><span class="p">(</span><span class="s">&quot;So far, so good&quot;</span><span class="p">)</span>
  <span class="k">throw</span> <span class="nc">RuntimeException</span><span class="p">(</span><span class="s">&quot;We can&#39;t continue&quot;</span><span class="p">)</span>
  <span class="n">println</span><span class="p">(</span><span class="s">&quot;You will never see this&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike in Java, there is no notion of “checked” exception in Scala.</p>
</div>
<p>Exceptions are chatched with <code class="docutils literal notranslate"><span class="pre">try</span></code> - <code class="docutils literal notranslate"><span class="pre">catch</span></code> expressions, which are similar to pattern matching:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@main</span> <span class="k">def</span> <span class="nf">run</span><span class="p">():</span> <span class="nc">Unit</span> <span class="o">=</span>
  <span class="k">try</span>
    <span class="c1">// Executed if no errors</span>
    <span class="n">attemptSomething</span><span class="p">()</span>
  <span class="k">catch</span>
    <span class="c1">// Executed if any error</span>
    <span class="k">case</span> <span class="n">exn</span><span class="p">:</span> <span class="nc">RuntimeException</span> <span class="o">=&gt;</span>
      <span class="nc">System</span><span class="p">.</span><span class="n">err</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">s&quot;Something went wrong: </span><span class="si">$</span><span class="n">exn</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="n">println</span><span class="p">(</span><span class="s">&quot;Stopping the program&quot;</span><span class="p">)</span>
  <span class="k">finally</span>
    <span class="c1">// Executed in any case</span>
    <span class="n">stream</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Exceptions follow <em>throwable hierarchy</em>:</p>
<a class="reference internal image-reference" href="../../_images/throwable_hierarchy.PNG"><img alt="Throwable hierarchy" src="../../_images/throwable_hierarchy.PNG" style="width: 80%;" /></a>
<p>Fatal exceptions like <code class="docutils literal notranslate"><span class="pre">OutOfMemoryError</span></code> should never be caught. Scala provides <code class="docutils literal notranslate"><span class="pre">scala.util.control.NonFatal</span></code> to catch all non-fatal exceptions:</p>
<div class="section" id="defensive-programming">
<h3>Defensive programming<a class="headerlink" href="#defensive-programming" title="Permalink to this headline"> &sect;</a></h3>
<p>Exceptions should be used as a last resort. One common practice is defining an exception error handler at the beginning of a program and explicitly indicate in the result type of the method that it can either succeed or fail, which is achieved with <strong>``Try`` type, that wraps the program implementation</strong>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nc">Try</span>

<span class="k">def</span> <span class="nf">attemptSomething</span><span class="p">():</span> <span class="nc">Try</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span> <span class="o">=</span>
  <span class="nc">Try</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Try</span></code> returns either a <code class="docutils literal notranslate"><span class="pre">Success</span></code> or <code class="docutils literal notranslate"><span class="pre">Failure</span></code>. At the use site, errors can be handled calling <code class="docutils literal notranslate"><span class="pre">recover</span></code> method:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@main</span> <span class="k">def</span> <span class="nf">run</span><span class="p">():</span> <span class="nc">Unit</span> <span class="o">=</span>
  <span class="n">attemptSomething</span><span class="p">()</span>
    <span class="p">.</span><span class="n">recover</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">exn</span><span class="p">:</span> <span class="nc">RuntimeException</span> <span class="o">=&gt;</span> <span class="p">...</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>A condensed way of handling exceptions is by using <strong>partial functions</strong>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">handler</span><span class="p">:</span> <span class="nc">PartialFunction</span><span class="p">[</span><span class="nc">Throwable</span><span class="p">,</span> <span class="nc">Unit</span><span class="p">]</span> <span class="o">=</span>
  <span class="k">case</span> <span class="n">exn</span><span class="p">:</span> <span class="nc">RuntimeException</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">&quot;An exception was thrown&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which is equivalent to:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">handler</span><span class="p">:</span> <span class="nc">PartialFunction</span><span class="p">[</span><span class="nc">Throwable</span><span class="p">,</span> <span class="nc">Unit</span><span class="p">]</span> <span class="o">=</span>
  <span class="k">new</span> <span class="nc">PartialFunction</span><span class="p">[</span><span class="nc">Throwable</span><span class="p">,</span> <span class="nc">Unit</span><span class="p">]:</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nc">Throwable</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="n">t</span> <span class="k">match</span>
      <span class="k">case</span> <span class="n">exn</span><span class="p">:</span> <span class="nc">RuntimeException</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">&quot;An exception was thrown&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">isDefinedAt</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nc">Throwable</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="o">=</span> <span class="n">t</span> <span class="k">match</span>
      <span class="k">case</span> <span class="n">exn</span><span class="p">:</span> <span class="nc">RuntimeException</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="k">case</span> <span class="n">_</span>                     <span class="o">=&gt;</span> <span class="kc">false</span>
</pre></div>
</div>
<p>Explicit modelling of failures may not always be relevant, it is probably a good choice if failure is likely to happen.</p>
<p>Usually when using a <code class="docutils literal notranslate"><span class="pre">Try[A]</span></code> resulting method we want to focus on the success case and leave the error handling for later. One way to do it is using <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> like so:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">java</span><span class="p">.</span><span class="nn">time</span><span class="p">.</span><span class="nc">LocalDate</span>
<span class="k">import</span> <span class="nn">java</span><span class="p">.</span><span class="nn">time</span><span class="p">.</span><span class="nc">Period</span>
<span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nc">Try</span>

<span class="k">def</span> <span class="nf">parseDate</span><span class="p">(</span><span class="n">str</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Try</span><span class="p">[</span><span class="nc">LocalDate</span><span class="p">]</span> <span class="o">=</span>
  <span class="nc">Try</span><span class="p">(</span><span class="nc">LocalDate</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">tryPeriod</span><span class="p">(</span><span class="n">str1</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">str2</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Try</span><span class="p">[</span><span class="nc">Period</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">parseDate</span><span class="p">(</span><span class="n">str1</span><span class="p">).</span><span class="n">flatMap</span> <span class="p">{</span> <span class="p">(</span><span class="n">date1</span><span class="p">:</span> <span class="nc">LocalDate</span> <span class="o">=&gt;</span>
    <span class="n">parseDate</span><span class="p">(</span><span class="n">str2</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="n">date2</span><span class="p">:</span> <span class="nc">LocalDate</span> <span class="o">=&gt;</span>
      <span class="nc">Period</span><span class="p">.</span><span class="n">between</span><span class="p">(</span><span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Alternative syntax using <code class="docutils literal notranslate"><span class="pre">for</span></code> statement would be:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tryPeriod</span><span class="p">(</span><span class="n">str1</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">str2</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Try</span><span class="p">[</span><span class="nc">Period</span><span class="p">]</span> <span class="o">=</span>
  <span class="k">for</span>
    <span class="n">date1</span> <span class="o">&lt;-</span> <span class="n">parseDate</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span>
    <span class="n">date2</span> <span class="o">&lt;-</span> <span class="n">parseDate</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
  <span class="k">yield</span>
    <span class="nc">Period</span><span class="p">.</span><span class="n">between</span><span class="p">(</span><span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">)</span>
</pre></div>
</div>
<p>As a summary on <code class="docutils literal notranslate"><span class="pre">trait</span> <span class="pre">Try[A]</span></code> to deal with successes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">map[B](f:</span> <span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">B):</span> <span class="pre">Try[B]</span></code>: Transforms successful value of type <code class="docutils literal notranslate"><span class="pre">A</span></code> into successful value of type <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">flatMap[B](f:</span> <span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">Try[B]):</span> <span class="pre">Try[B]</span></code>: Try to transform successful value of type <code class="docutils literal notranslate"><span class="pre">A</span></code> into a value of type <code class="docutils literal notranslate"><span class="pre">B</span></code>. A continuation function is given that may also fail.</p></li>
</ul>
<p>Both immediately return failure if the undermined value in which they are applied is already a failure. To convert failures into successes.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">recover(f:</span> <span class="pre">PartialFunction[Throwable,</span> <span class="pre">A]):</span> <span class="pre">Try[A]</span></code>: If it is defined for the type of failure that is being obtained from the underlying value, it converts it to a success, if not the failure simply propagates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">recoverWith(f:</span> <span class="pre">PartialFunction[Throwable,</span> <span class="pre">Try[A]]):</span> <span class="pre">Try[A]</span></code>: Similar to the <code class="docutils literal notranslate"><span class="pre">recover</span></code> but with a continuation function that may also fail the conversion.</p></li>
</ul>
</div>
<div class="section" id="validating-data">
<h3>Validating data<a class="headerlink" href="#validating-data" title="Permalink to this headline"> &sect;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In practice, third-party libraries are used to handle validation exceptions. Here just the general reasoning is outlined.</p>
</div>
<p>Validation errors are modelled as a collection of messages: <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">Errors</span> <span class="pre">=</span> <span class="pre">Seq[String]</span></code> and then validated values of type <code class="docutils literal notranslate"><span class="pre">A</span></code> are modelled to be either <code class="docutils literal notranslate"><span class="pre">Error``s</span> <span class="pre">or</span> <span class="pre">``A</span></code>: <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">Validated[A]</span> <span class="pre">=</span> <span class="pre">Either[Errors,</span> <span class="pre">A]</span></code>. <code class="docutils literal notranslate"><span class="pre">Either</span></code> type comes from Scala standard library and takes 2 type parameters <em>left type</em> and <em>right type</em>. It is used like: <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">validInt:</span> <span class="pre">Validated[Int]</span> <span class="pre">=</span> <span class="pre">Right(42)</span></code> or <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">invalidInt:</span> <span class="pre">Validated[Int]</span> <span class="pre">=</span> <span class="pre">Left(Seq(&quot;Invalid</span> <span class="pre">integer&quot;))</span></code>. Pattern matching can be used with either types, also like with <code class="docutils literal notranslate"><span class="pre">Try</span></code> we can use <code class="docutils literal notranslate"><span class="pre">map</span></code> to transform valid (right) value without dealing with error cases.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">map</span></code> only transforms right value of an <code class="docutils literal notranslate"><span class="pre">Either</span></code> so errors must be settled on the <code class="docutils literal notranslate"><span class="pre">left</span></code> side.</p>
</div>
<p>Usually, when combining validated values we want to first validate all values and then combine all of them (or see all the errors, not just first one), to achieve this we would have to implement a new type that combines validated values, usually called <code class="docutils literal notranslate"><span class="pre">zip</span></code> or <code class="docutils literal notranslate"><span class="pre">product</span></code> in third-party libraries.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validateEach</span><span class="p">[</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">](</span><span class="n">as</span><span class="p">:</span> <span class="nc">Seq</span><span class="p">[</span><span class="nc">A</span><span class="p">])(</span><span class="n">validate</span><span class="p">:</span> <span class="nc">A</span> <span class="o">=&gt;</span> <span class="nc">Validated</span><span class="p">[</span><span class="nc">B</span><span class="p">]):</span> <span class="nc">Validated</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">B</span><span class="p">]]</span> <span class="o">=</span>
  <span class="n">as</span><span class="p">.</span><span class="n">foldLeft</span><span class="p">[</span><span class="nc">Validated</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">B</span><span class="p">]]](</span><span class="nc">Right</span><span class="p">(</span><span class="nc">Vector</span><span class="p">.</span><span class="n">empty</span><span class="p">))</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">validatedBs</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="kd">val</span> <span class="n">validatedB</span><span class="p">:</span> <span class="nc">Validated</span><span class="p">[</span><span class="nc">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
      <span class="n">validateBoth</span><span class="p">(</span><span class="n">validatedBs</span><span class="p">,</span> <span class="n">validatedB</span><span class="p">)</span>
        <span class="p">.</span><span class="n">map</span><span class="p">((</span><span class="n">bs</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">bs</span> <span class="o">:+</span> <span class="n">b</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">validateEach</span></code> is usually coming from third-party libraries with the names <code class="docutils literal notranslate"><span class="pre">traverse</span></code> or <code class="docutils literal notranslate"><span class="pre">forEach</span></code>. As a summary:</p>
<ul class="simple">
<li><p>Transform valid data with <code class="docutils literal notranslate"><span class="pre">map</span></code></p></li>
<li><p>Aggregate valid data with <code class="docutils literal notranslate"><span class="pre">validateBoth</span></code></p></li>
<li><p>Chain validation rules with <code class="docutils literal notranslate"><span class="pre">flatMap</span></code></p></li>
<li><p>Validate a collection of values with <code class="docutils literal notranslate"><span class="pre">validateEach</span></code></p></li>
</ul>
<p>Read <a class="reference internal" href="#parsing-a-list-of-dates-from-a-file"><span class="std std-ref">Parsing a list of dates from a file</span></a> to see a showcase.</p>
</div>
</div>
<div class="section" id="concurrent-programming">
<h2>Concurrent programming<a class="headerlink" href="#concurrent-programming" title="Permalink to this headline"> &sect;</a></h2>
<p>A lot of applications are powered by systems made of several physical machines (nodes) communicating together. 2 concerns immediately arise from this architecture:</p>
<ul class="simple">
<li><p>What happens if clients modify system state simultaneously</p></li>
<li><p>How can the server handle requests coming from multiple clients simultaneously</p></li>
</ul>
<p>This pattern repeats at node level too. To solve this situations:</p>
<ol class="arabic simple">
<li><p>Leveraging multiple CPUs in a single program requires <strong>multi-threading</strong>.</p></li>
<li><p>Sharing data between threads requires using <strong>thread-safe</strong> data structures (as those that can be found, within a single JVM, on <code class="docutils literal notranslate"><span class="pre">java.util.concurrent.atomic</span></code> or <code class="docutils literal notranslate"><span class="pre">scala.collection.concurrent</span></code>.</p></li>
</ol>
<p>In Scala the <code class="docutils literal notranslate"><span class="pre">Future</span></code> type is used to model results coming from different threads (represents values that might be available in the <em>future</em>). To model the state of a <code class="docutils literal notranslate"><span class="pre">Future[A]</span></code> value at any point in time we use <code class="docutils literal notranslate"><span class="pre">Option[Try[A]]</span></code>, e.g.:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bcrypt</span><span class="p">(</span><span class="n">saltRound</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">Byte</span><span class="p">]]</span>
<span class="k">def</span> <span class="nf">insertUser</span><span class="p">(</span><span class="n">login</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">passwordHash</span><span class="p">:</span> <span class="nc">Seq</span><span class="p">[</span><span class="nc">Byte</span><span class="p">]):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">hashPasswordAndInsertUser</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">pass</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">bcrypt</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">pass</span><span class="p">)</span>
    <span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">passwordHash</span> <span class="o">=&gt;</span> <span class="n">insertUser</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">passwordHash</span><span class="p">))</span>

<span class="c1">// For fixed number of asynchronous computations</span>
<span class="kd">val</span> <span class="n">eventualAlice</span><span class="p">:</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">hashPasswordAndInsertUser</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span> <span class="s">&quot;abc123&quot;</span><span class="p">)</span>
<span class="kd">val</span> <span class="n">eventualBob</span><span class="p">:</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">hashPasswordAndInsertUser</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="s">&quot;123abc&quot;</span><span class="p">)</span>
<span class="kd">val</span> <span class="n">eventualAliceAndBob</span><span class="p">:</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">User</span><span class="p">,</span> <span class="nc">User</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">eventualAlice</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">eventualBob</span><span class="p">)</span>

<span class="c1">// For an arbitrary number of asynchronous computation</span>
<span class="kd">val</span> <span class="n">userData</span><span class="p">:</span> <span class="nc">Seq</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">)]</span> <span class="o">=</span> <span class="nc">Seq</span><span class="p">(</span>
  <span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;abc123&quot;</span><span class="p">,</span>
  <span class="s">&quot;Bob&quot;</span>   <span class="o">-&gt;</span> <span class="s">&quot;123abc&quot;</span>
<span class="p">)</span>
<span class="nc">Future</span><span class="p">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">userDate</span><span class="p">)(</span><span class="n">hashPasswordAndInsertUser</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">traverse</span></code> executes asynchronous computations independently in no predefined order.</p>
</div>
<p>Failures in <code class="docutils literal notranslate"><span class="pre">Future</span></code> values are handled with <code class="docutils literal notranslate"><span class="pre">recover</span></code> and <code class="docutils literal notranslate"><span class="pre">recoverWith</span></code> operations:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">evantuallyInserted</span><span class="p">:</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">Boolean</span><span class="p">]</span> <span class="o">=</span>
  <span class="n">hashPasswordAndInsertUser</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span> <span class="s">&quot;abc123&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="n">recover</span> <span class="p">{</span> <span class="k">case</span> <span class="nc">NonFatal</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kc">false</span> <span class="p">}</span>
</pre></div>
</div>
<div class="section" id="execution-context">
<h3>Execution context<a class="headerlink" href="#execution-context" title="Permalink to this headline"> &sect;</a></h3>
<p>By default Scala provides a thread-pool with as many threads as the number of physical processors. So parallelism level is equal to the number of processors. Third-parties can provided custom execution contexts (with a different number of threads). All methods defined on <code class="docutils literal notranslate"><span class="pre">Future</span></code> (like <code class="docutils literal notranslate"><span class="pre">map</span></code> or <code class="docutils literal notranslate"><span class="pre">zip</span></code>) follows the notation:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">A</span><span class="p">]:</span>
  <span class="k">def</span> <span class="nf">map</span><span class="p">[</span><span class="nc">B</span><span class="p">](</span><span class="n">f</span><span class="p">:</span> <span class="nc">A</span> <span class="o">=&gt;</span> <span class="nc">B</span><span class="p">)(</span><span class="k">using</span> <span class="nc">ExecutionContext</span><span class="p">):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">B</span><span class="p">]</span>
  <span class="p">...</span>
</pre></div>
</div>
<p>Meaning that the <code class="docutils literal notranslate"><span class="pre">ExecutionContext</span></code> is an additional parameter. Sometimes tasks block a thread while doing nothing, in such cases more threads than the number of physical processors must be created to not starve the thread-pool, which is achieved by wrapping code inside <code class="docutils literal notranslate"><span class="pre">concurrent.blocking</span></code>.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="business-logic">
<h2>Business Logic<a class="headerlink" href="#business-logic" title="Permalink to this headline"> &sect;</a></h2>
<div class="section" id="video-streaming-footprint">
<h3>Video Streaming Footprint<a class="headerlink" href="#video-streaming-footprint" title="Permalink to this headline"> &sect;</a></h3>
<ul class="simple">
<li><p>Data centers consume 0.000072 kWh/MB of video</p></li>
<li><p>Mobile Networks consume 0.00088 kWh/MB of video</p></li>
<li><p>Fixed Networks consume 0.00043 kWh/MB of video</p></li>
<li><p>Producing 1 kWh of electricity emits 0.5 kg of CO₂</p></li>
<li><p>High definition requires 0.6 MB/s</p></li>
<li><p>Low definition requires 0.3 MB/s</p></li>
</ul>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">Experience</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span>

<span class="k">enum</span> <span class="nc">Network</span>
  <span class="k">case</span> <span class="nc">Fixed</span><span class="p">,</span> <span class="nc">Mobile</span>

<span class="kd">val</span> <span class="n">lowQuality</span>  <span class="o">=</span> <span class="mf">0.3</span> <span class="c1">// MB/s</span>
<span class="kd">val</span> <span class="n">highQuality</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1">// MB/s</span>
<span class="kd">val</span> <span class="n">dataCenterEnergy</span> <span class="o">=</span> <span class="mf">0.000072</span> <span class="c1">// kWh</span>
<span class="kd">val</span> <span class="n">kgCO2PerKwh</span>      <span class="o">=</span> <span class="mf">0.5</span> <span class="c1">// kWh</span>

<span class="kd">val</span> <span class="n">thirtyMinutes</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span> <span class="c1">// seconds</span>

<span class="kd">val</span> <span class="n">highQualityAndMobile</span> <span class="o">=</span>
  <span class="nc">Experience</span><span class="p">(</span><span class="n">thirtyMinutes</span><span class="p">,</span> <span class="n">highQuality</span><span class="p">,</span> <span class="nc">Network</span><span class="p">.</span><span class="nc">Mobile</span><span class="p">)</span>

<span class="kd">val</span> <span class="n">lowQualityAndFixed</span> <span class="o">=</span>
  <span class="nc">Experience</span><span class="p">(</span><span class="n">thirtyMinutes</span><span class="p">,</span> <span class="n">lowQuality</span><span class="p">,</span> <span class="nc">Network</span><span class="p">.</span><span class="nc">Fixed</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="n">experience</span><span class="p">:</span> <span class="nc">Experience</span><span class="p">):</span> <span class="nc">Double</span> <span class="o">=</span>
  <span class="kd">val</span> <span class="n">megabytes</span> <span class="o">=</span> <span class="n">experience</span><span class="p">.</span><span class="n">duration</span> <span class="o">*</span> <span class="n">experience</span><span class="p">.</span><span class="n">definition</span>
  <span class="kd">val</span> <span class="n">energy</span>    <span class="o">=</span> <span class="n">dataCenterEnergy</span> <span class="o">+</span> <span class="n">networkEnergy</span><span class="p">(</span><span class="n">experience</span><span class="p">.</span><span class="n">network</span><span class="p">)</span>
  <span class="n">energy</span> <span class="o">*</span> <span class="n">megabytes</span> <span class="o">*</span> <span class="n">kgCO2PerKwh</span>

<span class="n">footprint</span><span class="p">(</span><span class="n">lowQualityAndFixed</span><span class="p">)</span>   <span class="c1">// : Double = 0.13554</span>
<span class="n">footprint</span><span class="p">(</span><span class="n">highQualityAndMobile</span><span class="p">)</span> <span class="c1">// : Double = 0.51408</span>
</pre></div>
</div>
</div>
<div class="section" id="card-game-set">
<h3>Card Game: Set<a class="headerlink" href="#card-game-set" title="Permalink to this headline"> &sect;</a></h3>
<p>A card has the following properties:</p>
<ul class="simple">
<li><p>Shape: Diamond, squiggle or oval</p></li>
<li><p>Number of shapes: 1, 2 or 3</p></li>
<li><p>Shading: Solid, stripped or open</p></li>
<li><p>Color: Red, Green or Purple</p></li>
</ul>
<p>A set is formed by 3 cards iff they have all the shame value for each property or the values are all different.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">Shape</span>
  <span class="k">case</span> <span class="nc">Diamond</span><span class="p">,</span> <span class="nc">Squiggle</span><span class="p">,</span> <span class="nc">Oval</span>
<span class="k">enum</span> <span class="nc">Number</span>
  <span class="k">case</span> <span class="nc">One</span><span class="p">,</span> <span class="nc">Two</span><span class="p">,</span> <span class="nc">Three</span>
<span class="k">enum</span> <span class="nc">Shading</span>
  <span class="k">case</span> <span class="nc">Solid</span><span class="p">,</span> <span class="nc">Stripped</span><span class="p">,</span> <span class="nc">Open</span>
<span class="k">enum</span> <span class="nc">Color</span>
  <span class="k">case</span> <span class="nc">Red</span><span class="p">,</span> <span class="nc">Green</span><span class="p">,</span> <span class="nc">Blue</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Card</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="nc">Shape</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span><span class="nc">Number</span><span class="p">,</span> <span class="n">shading</span><span class="p">:</span><span class="nc">Shading</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span><span class="nc">Color</span><span class="p">)</span>

<span class="c1">// Maybe I should include types here</span>
<span class="k">def</span> <span class="nf">checkProperty</span><span class="p">(</span><span class="n">card1_prop</span><span class="p">:</span> <span class="nc">Any</span><span class="p">,</span> <span class="n">card2_prop</span><span class="p">:</span> <span class="nc">Any</span><span class="p">,</span> <span class="n">card3_prop</span><span class="p">:</span> <span class="nc">Any</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="o">=</span>
  <span class="k">def</span> <span class="nf">allSame</span> <span class="o">=</span>
    <span class="n">card1_prop</span> <span class="o">==</span> <span class="n">card2_prop</span> <span class="o">&amp;&amp;</span> <span class="n">card1_prop</span> <span class="o">==</span> <span class="n">card3_prop</span>
  <span class="k">def</span> <span class="nf">allDifferent</span> <span class="o">=</span>
    <span class="n">card1_prop</span> <span class="o">!=</span> <span class="n">card2_prop</span> <span class="o">&amp;&amp;</span>
    <span class="n">card1_prop</span> <span class="o">!=</span> <span class="n">card3_prop</span> <span class="o">&amp;&amp;</span>
    <span class="n">card2_prop</span> <span class="o">!=</span> <span class="n">card3_prop</span>
 <span class="n">allSame</span> <span class="o">||</span> <span class="n">allDifferent</span>

<span class="k">def</span> <span class="nf">isValidSet</span><span class="p">(</span><span class="n">card1</span><span class="p">:</span> <span class="nc">Card</span><span class="p">,</span> <span class="n">card2</span><span class="p">:</span> <span class="nc">Card</span><span class="p">,</span> <span class="n">card3</span><span class="p">:</span> <span class="nc">Card</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="o">=</span>
  <span class="n">checkProperty</span><span class="p">(</span><span class="n">card1</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">card2</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">card3</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>       <span class="o">&amp;&amp;</span>
  <span class="n">checkProperty</span><span class="p">(</span><span class="n">card1</span><span class="p">.</span><span class="n">number</span><span class="p">,</span> <span class="n">card2</span><span class="p">.</span><span class="n">number</span><span class="p">,</span> <span class="n">card3</span><span class="p">.</span><span class="n">number</span><span class="p">)</span>    <span class="o">&amp;&amp;</span>
  <span class="n">checkProperty</span><span class="p">(</span><span class="n">card1</span><span class="p">.</span><span class="n">shading</span><span class="p">,</span> <span class="n">card2</span><span class="p">.</span><span class="n">shading</span><span class="p">,</span> <span class="n">card3</span><span class="p">.</span><span class="n">shading</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
  <span class="n">checkProperty</span><span class="p">(</span><span class="n">card1</span><span class="p">.</span><span class="n">color</span><span class="p">,</span> <span class="n">card2</span><span class="p">.</span><span class="n">color</span><span class="p">,</span> <span class="n">card3</span><span class="p">.</span><span class="n">color</span><span class="p">)</span>

<span class="n">isValidSet</span><span class="p">(</span>
  <span class="nc">Card</span><span class="p">(</span><span class="nc">Shape</span><span class="p">.</span><span class="nc">Diamond</span><span class="p">,</span> <span class="nc">Number</span><span class="p">.</span><span class="nc">One</span><span class="p">,</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">Purple</span><span class="p">,</span> <span class="nc">Shading</span><span class="p">.</span><span class="nc">Stripped</span><span class="p">),</span>
  <span class="nc">Card</span><span class="p">(</span><span class="nc">Shape</span><span class="p">.</span><span class="nc">Squiggle</span><span class="p">,</span> <span class="nc">Number</span><span class="p">.</span><span class="nc">One</span><span class="p">,</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">Red</span><span class="p">,</span> <span class="nc">Shading</span><span class="p">.</span><span class="nc">Stripped</span><span class="p">),</span>
  <span class="nc">Card</span><span class="p">(</span><span class="nc">Shape</span><span class="p">.</span><span class="nc">Oval</span><span class="p">,</span> <span class="nc">Number</span><span class="p">.</span><span class="nc">One</span><span class="p">,</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">Green</span><span class="p">,</span> <span class="nc">Shading</span><span class="p">.</span><span class="nc">Stripped</span><span class="p">)</span>
<span class="p">)</span> <span class="c1">// : Boolean = true</span>
</pre></div>
</div>
</div>
<div class="section" id="basketball">
<h3>Basketball<a class="headerlink" href="#basketball" title="Permalink to this headline"> &sect;</a></h3>
<p>Given position, shot direction and force evaluate if a ball ig going to pass through the hoop.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">Position</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Double</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">distanceTo</span><span class="p">(</span><span class="n">that</span><span class="p">:</span> <span class="nc">Position</span><span class="p">):</span> <span class="nc">Double</span> <span class="o">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="nf">distanceToLine</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="p">(</span><span class="nc">Position</span><span class="p">,</span> <span class="nc">Position</span><span class="p">)):</span> <span class="nc">Double</span> <span class="o">=</span> <span class="o">???</span>

<span class="k">object</span> <span class="nc">Position</span><span class="p">:</span>
  <span class="kd">val</span> <span class="n">player</span> <span class="o">=</span> <span class="nc">Position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.80</span><span class="p">)</span>
  <span class="nc">VAL</span> <span class="n">hoop</span>   <span class="o">=</span> <span class="nc">Position</span><span class="p">(</span><span class="mf">6.75</span><span class="p">,</span> <span class="mf">3.048</span><span class="p">)</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Angle</span><span class="p">(</span><span class="n">radians</span><span class="p">:</span> <span class="nc">Double</span><span class="p">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Speed</span><span class="p">(</span><span class="n">metersPerSecond</span><span class="p">:</span> <span class="nc">Double</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">isWinningShot</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="nc">Angle</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nc">Speed</span><span class="p">):</span> <span class="nc">Boolean</span>
  <span class="kd">val</span> <span class="n">v0X</span> <span class="o">=</span> <span class="n">speed</span><span class="p">.</span><span class="n">metersPerSecond</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">.</span><span class="n">radians</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">v0Y</span> <span class="o">=</span> <span class="n">speed</span><span class="p">.</span><span class="n">metersPerSecond</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">.</span><span class="n">radians</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">p0X</span> <span class="o">=</span> <span class="nc">Position</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">x</span>
  <span class="kd">val</span> <span class="n">p0Y</span> <span class="o">=</span> <span class="nc">Position</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">y</span>
  <span class="kd">val</span> <span class="n">g</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">9.81</span>

  <span class="k">def</span> <span class="nf">goesThoughHoop</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="p">(</span><span class="nc">Position</span><span class="p">,</span> <span class="nc">Position</span><span class="p">)):</span> <span class="nc">Boolean</span> <span class="o">=</span>
    <span class="nc">Postion</span><span class="p">.</span><span class="n">hoop</span><span class="p">.</span><span class="n">distanceToLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span>

  <span class="k">def</span> <span class="nf">isNotTooFar</span><span class="p">(</span><span class="n">position</span><span class="p">:</span> <span class="nc">Position</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="o">=</span>
    <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="nc">Position</span><span class="p">.</span><span class="n">hoop</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.01</span>

  <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="nc">Position</span> <span class="o">=</span>
    <span class="kd">val</span> <span class="n">x</span> <span class="o">=</span> <span class="n">p0X</span> <span class="o">+</span> <span class="n">v0X</span> <span class="o">*</span> <span class="n">t</span>
    <span class="kd">val</span> <span class="n">y</span> <span class="o">=</span> <span class="n">p0Y</span> <span class="o">+</span> <span class="n">v0Y</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
    <span class="nc">Position</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1">// Collections implementation</span>
  <span class="kd">val</span> <span class="n">timings</span>   <span class="o">=</span> <span class="nc">LazyList</span><span class="p">.</span><span class="n">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">timings</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">lines</span>     <span class="o">=</span> <span class="n">positions</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
  <span class="n">lines</span>
    <span class="p">.</span><span class="n">takeWhile</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">isNotTooFar</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
    <span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">goesThoughHoop</span><span class="p">)</span>

<span class="c1">// Imperative representation</span>
   <span class="kd">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="kd">var</span> <span class="n">previousPosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
   <span class="kd">var</span> <span class="n">isWinning</span> <span class="o">=</span> <span class="kc">false</span>
   <span class="k">while</span> <span class="n">isNotTooFar</span><span class="p">(</span><span class="n">previousPosition</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isWinning</span> <span class="k">do</span>
     <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="mi">1</span>
     <span class="kd">val</span> <span class="n">nextPosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
     <span class="kd">val</span> <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">previousPosition</span><span class="p">,</span> <span class="n">nextPosition</span><span class="p">)</span>
     <span class="n">isWinning</span> <span class="o">=</span> <span class="n">goesThoughHoop</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
     <span class="n">previousPosition</span> <span class="o">=</span> <span class="n">nextPosition</span>
   <span class="n">isWinning</span>

<span class="c1">// Iterative implementation</span>
<span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="nc">Boolean</span> <span class="o">=</span>
  <span class="kd">val</span> <span class="n">currentPosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">isNotTooFar</span><span class="p">(</span><span class="n">currentPosition</span><span class="p">)</span> <span class="k">then</span>
    <span class="kd">val</span> <span class="n">nextPosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">val</span> <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">currentPosition</span><span class="p">,</span> <span class="n">nextPosition</span><span class="p">)</span>
    <span class="n">goesThoughHoop</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">||</span> <span class="n">loop</span><span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="kc">false</span>
<span class="n">loop</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">end</span> <span class="nn">isWinningShot</span>
</pre></div>
</div>
</div>
<div class="section" id="managing-addressbook">
<h3>Managing AddressBook<a class="headerlink" href="#managing-addressbook" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="nc">Address</span> <span class="o">=</span> <span class="p">(</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">String</span><span class="p">)</span> <span class="c1">// Zipcode, Street Name</span>
<span class="k">given</span> <span class="n">orderingPair</span><span class="p">[</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">](</span><span class="k">using</span> <span class="n">ordA</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">A</span><span class="p">],</span> <span class="n">ordB</span><span class="p">:</span> <span class="nc">Ordering</span><span class="p">[</span><span class="nc">B</span><span class="p">]):</span> <span class="nc">Ordering</span><span class="p">[(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">)]</span> <span class="k">with</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">t1</span><span class="p">:</span> <span class="p">(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">),</span> <span class="n">t2</span><span class="p">:</span> <span class="p">(</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">)):</span> <span class="nc">Int</span> <span class="o">=</span>
      <span class="kd">val</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ordA</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">t1</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">t2</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">c</span> <span class="k">else</span> <span class="n">ordB</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">t1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">t2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="kd">val</span> <span class="n">addresses</span><span class="p">:</span> <span class="nc">List</span><span class="p">[</span><span class="nc">Address</span><span class="p">]</span> <span class="o">=</span> <span class="nc">List</span><span class="p">(</span>
  <span class="p">(</span><span class="mi">2610</span><span class="p">,</span> <span class="s">&quot;Kouwerheide&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="s">&quot;Halewijillan&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2060</span><span class="p">,</span> <span class="s">&quot;Fort VII straat&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sort</span><span class="p">(</span><span class="n">addresses</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-a-list-of-dates-from-a-file">
<h3>Parsing a list of dates from a file<a class="headerlink" href="#parsing-a-list-of-dates-from-a-file" title="Permalink to this headline"> &sect;</a></h3>
<p>We have 2 different types of errors:</p>
<ol class="arabic simple">
<li><p>Errors while reading the file that must abort the program logging to error stream.</p></li>
<li><p>Errors while parsing dates that must not abort the program just ignore certain values</p></li>
</ol>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">readDateStrings</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Try</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span> <span class="o">=</span>
  <span class="nc">Using</span><span class="p">(</span><span class="nc">Source</span><span class="p">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span> <span class="p">{</span> <span class="n">source</span> <span class="o">=&gt;</span>
    <span class="n">source</span><span class="p">.</span><span class="n">getLines</span><span class="p">().</span><span class="n">toSeq</span>
  <span class="p">}</span>

<span class="k">def</span> <span class="nf">parseDate</span><span class="p">(</span><span class="n">str</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Validated</span><span class="p">[</span><span class="nc">LocalDate</span><span class="p">]</span> <span class="o">=</span>
  <span class="nc">Try</span><span class="p">(</span><span class="nc">LocalDate</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="k">match</span>
    <span class="k">case</span> <span class="nc">Failure</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nc">Left</span><span class="p">(</span><span class="nc">Seq</span><span class="p">(</span><span class="n">exception</span><span class="p">.</span><span class="n">toString</span><span class="p">()))</span>
    <span class="k">case</span> <span class="nc">Success</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>      <span class="o">=&gt;</span> <span class="nc">Right</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">readAndParseDates</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Try</span><span class="p">[</span><span class="nc">Validate</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">LocalDate</span><span class="p">]]]</span> <span class="o">=</span>
  <span class="n">readDateStrings</span><span class="p">(</span><span class="n">fileName</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">dateStrings</span> <span class="o">=&gt;</span>
    <span class="n">validateEach</span><span class="p">(</span><span class="n">dateStrings</span><span class="p">)(</span><span class="n">parseDate</span><span class="p">)</span>
  <span class="p">}</span>

<span class="nd">@main</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span>
  <span class="n">readAndParseDates</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="k">match</span>
    <span class="k">case</span> <span class="nc">Failure</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nc">System</span><span class="p">.</span><span class="n">err</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">s&quot;Unable to parse dates file: </span><span class="si">$</span><span class="n">exception</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="nc">Success</span><span class="p">(</span><span class="n">validatedDates</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">case</span> <span class="nc">Left</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="n">println</span><span class="p">(</span><span class="s">s&quot;Invalid data: </span><span class="si">${</span><span class="n">errors</span><span class="p">.</span><span class="n">mkString</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="k">case</span> <span class="nc">Right</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="n">println</span><span class="p">(</span><span class="s">s&quot;Successfully parsed dates: </span><span class="si">${</span><span class="n">dates</span><span class="p">.</span><span class="n">mkString</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fetching-data-from-webservice">
<h3>Fetching data from webservice<a class="headerlink" href="#fetching-data-from-webservice" title="Permalink to this headline"> &sect;</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">concurrent</span><span class="p">.</span><span class="nc">Future</span>
<span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">concurrent</span><span class="p">.</span><span class="nc">ExecutionContext</span><span class="p">.</span><span class="nc">Implicits</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nc">Random</span>
<span class="k">import</span> <span class="nn">scala</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nn">control</span><span class="p">.</span><span class="nc">NonFatal</span>

<span class="k">def</span> <span class="nf">getPagesCount</span><span class="p">():</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Future</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">getPage</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="o">=</span>
  <span class="k">if</span> <span class="nc">Random</span><span class="p">.</span><span class="n">nextDouble</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.95</span> <span class="k">then</span>
    <span class="nc">Future</span><span class="p">.</span><span class="n">failed</span><span class="p">(</span><span class="nc">Exception</span><span class="p">(</span><span class="s">s&quot;Timeout when fetching page </span><span class="si">$</span><span class="n">page</span><span class="s">&quot;</span><span class="p">))</span>
  <span class="k">else</span> <span class="nc">Future</span><span class="p">(</span><span class="s">s&quot;Page </span><span class="si">$</span><span class="n">page</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c1">// Async version</span>
<span class="k">def</span> <span class="nf">getAllPages</span><span class="p">():</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span> <span class="o">=</span>
  <span class="n">getPagesCount</span><span class="p">().</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">pagesCount</span> <span class="o">=&gt;</span>
    <span class="kd">val</span> <span class="n">allPages</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">pagesCount</span>
    <span class="nc">Future</span><span class="p">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">allPages</span><span class="p">)(</span><span class="n">getPage</span><span class="p">)</span>
  <span class="p">}</span>

<span class="c1">// Sequential version</span>
<span class="k">def</span> <span class="nf">getAllPages</span><span class="p">():</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span> <span class="o">=</span>
  <span class="n">getPagesCount</span><span class="p">().</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">pagesCount</span> <span class="o">=&gt;</span>
    <span class="kd">val</span> <span class="n">allPages</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">pagesCount</span>
    <span class="n">allPages</span><span class="p">.</span><span class="n">foldLeft</span><span class="p">[</span><span class="nc">Future</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]]](</span><span class="nc">Future</span><span class="p">.</span><span class="nc">Successful</span><span class="p">(</span><span class="nc">Vector</span><span class="p">.</span><span class="n">empty</span><span class="p">))</span> <span class="p">{</span>
      <span class="p">(</span><span class="n">eventualPreviousPages</span><span class="p">,</span> <span class="nc">PageNumber</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="n">eventualPreviousPages</span><span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">previousPages</span> <span class="o">=&gt;</span>
          <span class="n">getPage</span><span class="p">(</span><span class="n">pageNumber</span><span class="p">)</span>
            <span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">pageContent</span> <span class="o">=&gt;</span> <span class="n">previousPages</span> <span class="o">:+</span> <span class="n">pageContent</span><span class="p">)</span>
          <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

 <span class="c1">// Resilient asynchronous version</span>
 <span class="k">def</span> <span class="nf">resilientGetPage</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="o">=</span>
   <span class="kd">val</span> <span class="n">maxAttempts</span> <span class="o">=</span> <span class="mi">3</span>
   <span class="k">def</span> <span class="nf">attempt</span><span class="p">(</span><span class="n">remainingAttempts</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="o">=</span>
     <span class="k">if</span> <span class="n">remainingAttempts</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
       <span class="nc">Future</span><span class="p">.</span><span class="n">failed</span><span class="p">(</span><span class="nc">Exception</span><span class="p">(</span><span class="s">s&quot;Failed after </span><span class="si">$</span><span class="n">maxAttempts</span><span class="s">&quot;</span><span class="p">))</span>
     <span class="k">else</span>
       <span class="n">println</span><span class="p">(</span><span class="s">s&quot;Trying to fetch page </span><span class="si">$</span><span class="n">page</span><span class="s"> (</span><span class="si">$</span><span class="n">remainingAttempts</span><span class="s"> attemps remaining)&quot;</span><span class="p">)</span>
       <span class="n">getPage</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="n">recoverWith</span> <span class="p">{</span> <span class="k">case</span> <span class="nc">NonFatal</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">=&gt;</span>
         <span class="nc">System</span><span class="p">.</span><span class="n">err</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">s&quot;Fetching page </span><span class="si">$</span><span class="n">page</span><span class="s"> failed…&quot;</span><span class="p">)</span>
         <span class="n">attempt</span><span class="p">(</span><span class="n">remainingAttempts</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
       <span class="p">}</span>
   <span class="n">attempt</span><span class="p">(</span><span class="n">maxAttempts</span><span class="p">)</span>

 <span class="k">def</span> <span class="nf">resilientGetAllPages</span><span class="p">():</span> <span class="nc">Future</span><span class="p">[</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span> <span class="o">=</span>
  <span class="n">getPagesCount</span><span class="p">().</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">pagesCount</span> <span class="o">=&gt;</span>
    <span class="kd">val</span> <span class="n">allPages</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">pagesCount</span>
    <span class="nc">Future</span><span class="p">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">allPages</span><span class="p">)(</span><span class="n">resilientGetPage</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


        </div>
    </div>
    <div class="footer">&copy;2021, Prophet Jeremy.
       Powered by:&nbsp;<a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
       &nbsp;&amp;&nbsp;<a href="https://github.com/santibreo/pj-theme">PJnotes 1.0.0</a>
      
    </div>

    
  </body>
</html>